function startExercise(n){if(typeof n=="undefined")mapJsonToExerciseJson(function(n){let t=new ITEM.Exercise(n,{contentWrapSelector:"#assetContentWrapper",exerciseSelector:"#assetContentWrapper .task__list",defaultAreaInstructionDelay:5e3,autoHideAreaErrorInstructionsAfter:5e3,help:!0,assetsPath:"",showIntro:!0,navigation:{selector:"#nav",allowPreviousTask:!0,allowNextTask:!0}});t.Start()},function(n){console.error("Unable to load exercise JSON:",n)});else{let t=new ITEM.Exercise(n,{contentWrapSelector:"#assetContentWrapper",exerciseSelector:"#assetContentWrapper .task__list",defaultAreaInstructionDelay:5e3,autoHideAreaErrorInstructionsAfter:5e3,help:!0,assetsPath:"",showIntro:!0,navigation:{selector:"#nav",allowPreviousTask:!0,allowNextTask:!0}});t.Start()}}function mapJsonToExerciseJson(n,t){var i=$.getJSON({url:"assets/json/umbraco-test.json",success:function(t){let i=JSON.parse(JSON.stringify(t));typeof n=="function"?n(i):console.error("No success callback specified.")},error:function(n){typeof t=="function"?t(n):console.error("No error callback specified.")}})}const ITEM={};ITEM.Exercise=function(n,t){function ae(){i.didStart=!1;i.isFinished=!1;i.isPaused=!1;i.isShowingSettings=!1;i.isShowingResults=!1}function ve(){r("init Exercise.js");ps(i.jsonData);t.debugMode&&ih();we();ys(i.jsonData);bs(i.jsonData);ws(i.jsonData);pe();nu();s()}function ye(){r("start");t.showIntro||i.didStart?gr():(dr=new Date,i.didStart=!0,d.InitInputController(i.TaskObjectArray[i.currentTaskIndex]),yt())}function pe(){d.InitInputController(i.TaskObjectArray[i.currentTaskIndex]);$(ir).on("click",wo);$(rr).on("click",ke);$(ut).on("click",pt);$(ft).on("click",wt);$(ur).on("click",yi);$(ct).on("click",ss);$(et).on("click",bo);$(ot).on("click",ko);$(st).on("click",go);$(ht).on("click",ns);$(yu).on("click",ts);$(ku).on("click",is);$(du).on("click",wi);$(dt).on("click",function(){wt();$(o).focus()});$(ti).on("click",gi);$(gu).on("click",po);$(nf).on("click",cs);$(uf).on("click",vo);$(er).on("click",yo);$(o).attr("tabindex","0").trigger("focus").on("focusout",io).on("focus",to)}function gr(){$(gt).addClass(e);$(gt).find(au).on("click",us)}function we(){a=ITEM.LogController({debugMode:t.debugMode},i.EventLog);d=ITEM.InputController({exerciseContainerSelector:o,dblClickDetect:!0,mouseDownDetect:!0,keyDownDetect:!0,logController:a,debugMode:t.debugMode});v=ITEM.AudioController({onDOMError:fs,debugMode:t.debugMode});y=ITEM.FeedbackController(`${o} ${ii}${f} ${rf}`,{debugMode:t.debugMode,logController:a,exerciseController:this},{feedbackComponentSelector:tf,activeTaskSelector:or});vi=ITEM.ResultsController(t,i,{});h=ITEM.MarkupController(t,i,{debugMode:t.debugMode});r("init controllers from exercise.js",{logController:a,inputController:d,audioController:v,feedbackController:y,resultController:vi,markupController:h})}function nu(){i.currentTaskIndex=0;i.currentTaskId=i.TaskObjectArray[0][at];i.currentTaskObject=i.TaskObjectArray[0];$(t.exerciseSelector).find(ii).removeClass(lt);$(t.exerciseSelector).find(ff).addClass(lt)}function yt(){!i.isFinished&&i.didStart&&(r("initTask (Exercise.js)",i.TaskObjectArray[i.currentTaskIndex]),$(f).before().find("input")&&$(o).trigger("focus"),d.InitTask(i.TaskObjectArray[i.currentTaskIndex]),ou(),es(),eu(),ki(),iu(),be())}function be(){if(!i.isFinished&&i.didStart){r("startTask",i.TaskObjectArray[i.currentTaskIndex]);r("startTask, audioControllerState:",v.GetAudioControllerState());let t=0;t&&t!=""||(t=0);let n=0;n&&n!=""||(n=0);i.TaskObjectArray[i.currentTaskIndex][p].length==0&&i.TaskObjectArray[i.currentTaskIndex][b]==0?n=500:i.TaskObjectArray[i.currentTaskIndex][p].length==0&&i.TaskObjectArray[i.currentTaskIndex][b]!=0&&(n=i.TaskObjectArray[i.currentTaskIndex][b]);let u=window.setTimeout(function(){(typeof n=="undefined"||n)&&hs();ls("proceedTimer",u);nr()},t);cu();su();di();i.TaskObjectArray[i.currentTaskIndex][p].length==0&&i.TaskObjectArray[i.currentTaskIndex][b]==0&&(r("startTask (task issues, no interaction && delay)"),setTimeout(w,n));i.TaskObjectArray[i.currentTaskIndex][p].length==0&&i.TaskObjectArray[i.currentTaskIndex][b]>0&&(r("startTask (no interactions, auto-proceed)",n),setTimeout(w,n));s()}}function w(){if(!i.isFinished&&i.didStart){let n={timeSpentOnTask:it};r("OnTaskEnd",n);hu();tu()}}function pt(){if(!i.isFinished&&i.didStart&&!i.isPaused){i.isPaused=!0;uo();os();tr();bt();let n={event:"Pause Task",timeStamp:Date.now(),task:$(o).find(f),explainer:"Paused Task."};a.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],n)}r("pauseTask, current EventLog:",i.EventLog);s()}function wt(){if(!i.isFinished&&!i.isShowingSettings&&i.didStart&&i.isPaused){let n=$(t.exerciseSelector).find(f);i.isPaused=!1;r("resumeTask",n);fu();n.find("input").length>0?n.find("input").trigger("focus"):$(o).is(":focus")||$(o).trigger("focus");eu();i.isSubtitled&&ki();di();nr();s();let u={event:"Resume Task",timeStamp:Date.now(),task:$(o).find(f),explainer:"Resumed Task."};a.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],u)}}function yi(){if(!i.isFinished&&i.didStart){let n={event:"Skip Task",timeStamp:Date.now(),task:$(o).find(f),explainer:"Brugeren sprang opgavedelen over."};a.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],n);hu();tu()}}function ke(){if(bi(),!i.isFinished&&i.didStart){let n=$(t.exerciseSelector).find(f);i.currentTaskIndex>-1&&!n.is(":first-of-type")?(i.currentTaskIndex--,t.debugMode&&$(".taskCountSpan").text(`Opgave: ${i.currentTaskIndex+1}`),n.find("input:first").val(""),n.removeClass().addClass(sr),n.prev().addClass(lt),yt()):r("First Task - can not go back.")}}function tu(){if(bi(),!i.isFinished&&i.didStart){let n=$(t.exerciseSelector).find(f);i.currentTaskIndex++;r("goToNextTask (start)",n);t.debugMode&&$(".taskCountSpan").text(`Opgave: ${i.currentTaskIndex+1}`);i.TaskObjectArray[i.currentTaskIndex]==i.TaskObjectArray[i.TaskObjectArray.length]||n.is(":last-child")?ge():(n.removeClass().addClass(sr),n.next().addClass(lt),i.currentTask=$(t.exerciseSelector).find(f),yt())}}function iu(){r("cleanTask()");$(".show-click-effect").removeClass("show-click-effect");$(".show-keydown-effect").remove();clearTimeout(k);tr();it=0}function ru(){var o,s,u,n,h,e,v,l,t,c;r("autoCompleteTask (start)",i.TaskObjectArray);i.TaskObjectArray[i.currentTaskIndex].userObject.taskDetailObject.autoComplete=!0;let y={event:"Task Auto-Completed.",timeStamp:Date.now(),task:i.TaskObjectArray[i.currentTaskIndex],explainer:"User autocompleted/skipped task."};a.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],y,"User autocompleted/skipped task.");for(o of i.TaskObjectArray[i.currentTaskIndex][p])switch(o[oi]){case"stringinput":for(n of o[wr])if(n.correctInput[0]!=undefined){$(f+" input:first").val("");s=n.correctInput[0];u=0;function t(){u<s.length?($(f+" input:first").val($(f+" input:first").val()+s[u]),u++,setTimeout(t,75)):u===s.length&&(k=setTimeout(w,400))}t()}break;case"click":$(f+" .click:first").addClass("show-click-effect");k=setTimeout(w,1200);break;case"dblclick":$(f+" .dblclick:first").addClass("show-click-effect");k=setTimeout(w,1200);break;case"mouseover":$(f+" .mouseover:first").addClass("show-click-effect");k=setTimeout(w,1200);break;case"rightclick":$(f+" .rightclick:first").addClass("show-click-effect");k=setTimeout(w,1200);break;case"keydown":for(n of o[wr])if(n.correctInput!=undefined){t=n.correctInput;h=document.createElement("div");h.classList.add("show-keydown-effect");e=document.createElement("div");e.classList.add("data-key-wrapper");$(f+":first").append(h);$(h).append(e);function i(n){return{up:"🠅",right:"🠆",down:"🠇",left:"🠄",shift:"⇧ shift",meta:"⌘",alt:"⌥ alt",backspace:"⌫ backspace","return":"⏎ enter",capsLock:"caps lock",tab:"↹ tab"}[n]||n}if(t.includes("+")){v=t.split("+");l=[];for(t of v)l.push(`<div class="data-key">${i(t)}</div>`);c=l.join("+");e.innerHTML=c}else c=`<div class="data-key">${i(t)}</div>`,e.innerHTML=c}k=setTimeout(w,600)}}function de(){r("restartExercise",i);fu();ae();d.ICHandleRestartExercise();y.FCHandleRestartExercise();nu();gr();i.exerciseAttemptCount++}function ge(){i.isFinished=!0;r("handleEndExercise",i);let n={event:"Exercise Complete.",timeStamp:Date.now(),task:i.TaskObjectArray[i.currentTaskIndex],explainer:"User completed the exercise."};a.HandleOutputLogEntry(i.TaskObjectArray[i.TaskObjectArray.length-1],n,"Exercise Complete.");ou();bi();bt();iu();no();rs()}function no(){let n=vi.GetExerciseResultObjectArray(i);co();so();h.GenerateExerciseResultMarkup(n)}function to(){r("handleFocus",{showingResults:i.isShowingResults,pause:i.isPaused});wt()}function io(n){r("handleUnfocus",{isSubtitles:$(n.relatedTarget).is(l),event:n,relatedTarget:n.relatedTarget});$(n.relatedTarget).is($(t.exerciseSelector))&&pi();$(n.relatedTarget).is(vu)&&pi();($(n.relatedTarget).parents(l).length>0||$(n.relatedTarget).is(l))&&pi();i.isShowingResults||$(o).is(".ignore-unfocus")||$(n.relatedTarget).is("input")||pt();$(o).removeClass("ignore-unfocus")}function pi(){$(o).addClass("ignore-unfocus");$(o).trigger("focus")}function ro(){$(nt).addClass(e)}function uu(){$(nt).removeClass(e)}function uo(){$(dt).addClass(e);$("body").addClass(cr)}function fo(){$("body").removeClass(cr);$(dt).removeClass(e)}function eo(){i.isShowingSettings=!i.isShowingSettings;$(kt).toggleClass(e)}function oo(){return $(wu).toggleClass(e),$(this).toggleClass(ri),!1}function so(){i.isShowingResults=!0;$(fr).toggleClass(e)}function ho(){i.isShowingResults=!1;$(fr).removeClass(e)}function co(){$(bu).html("")}function lo(){i.isShowingSettings=!1;$(kt).removeClass(e)}function ao(){$(ni).addClass(e)}function wi(){$(ni).removeClass(e)}function fu(){wi();ho();fo();uu();lo()}function vo(){return bt(),!1}function eu(){let t=i.TaskObjectArray[i.currentTaskIndex],n=t.subtitles;r("loadTaskSubtitles",{currentTask:t,subtitles:n});i.isSubtitled&&typeof n!="undefined"&&n!=null&&n!=""&&($(l).addClass(hr),$(l).find("p:first").html(n))}function bi(){r("clearTaskSubtitles");$(l).removeClass(hr);$(l).find("p:first").html("")}function yo(){return r("moveTaskSubtitles()",er),$(l).toggleClass("moved"),!1}function po(){i.isSubtitled=!i.isSubtitled;s()}function ki(){return $(l).removeClass(u),!1}function bt(){return $(l).addClass(u),!1}function s(){i.isFinished?($(exerciseSettings).addClass(u),$(ct).addClass(u)):($(exerciseSettings).removeClass(u),$(ct).removeClass(u));i.isPaused?($(ut).addClass(u),$(ft).removeClass(u)):($(ft).addClass(u),$(ut).removeClass(u));i.isMuted?($(et).removeClass(u),$(ot).addClass(u)):($(et).addClass(u),$(ot).removeClass(u));i.isSubtitled?($(st).addClass(u),$(ht).removeClass(u)):($(st).removeClass(u),$(ht).addClass(u))}function wo(){pt();eo()}function bo(){return gi(),s(),!1}function ko(){return gi(),s(),!1}function go(){i.isSubtitled=!0;ki();s()}function ns(){i.isSubtitled=!1;bt();s()}function ts(){$(ni).hasClass(e)?wi():(pt(),ao())}function is(){return r("handleRestartExerciseConfirmBtn",i),de(),!1}function rs(){$(rr).addClass(c);$(ut).addClass(c);$(ft).addClass(c);$(ur).addClass(c);$(et).addClass(c);$(ot).addClass(c);$(st).addClass(c);$(ht).addClass(c);$(ct).addClass(c);$(ir).addClass(c)}function us(n){r("handlerBeginExerciseBtn",n);n.preventDefault();dr=new Date;i.didStart=!0;$(gt).removeClass(e);yt()}function fs(n){tr();ro();$(nt).find(".error-action:first").html("Tryk her for at prøve igen.");$(nt).find(".error-detail:first").html(n);$(nt).on("click",function(){uu();di();nr()})}function ou(){v.ClearAudioFile()}function es(){v.LoadAudioFile(t.assetsPath+i.TaskObjectArray[i.currentTaskIndex][fi])}function di(){r("playTaskAudioFile");v.PlayAudio()}function os(){v.PauseAudio()}function ss(){r("replayTaskAudioFile (exercise.js)",i);i.isFinished||(v.ReplayAudio(),wt())}function gi(){i.isMuted=!i.isMuted;su();s()}function su(){i.isMuted?v.MuteAudio():v.UnmuteAudio()}function hu(){let n=i.TaskObjectArray[i.currentTaskIndex];a.StoreLogEntriesToTask(n)}function hs(){}function cs(){i.hideFeedback=!i.hideFeedback;cu();s()}function cu(){r("handleFeedbackState() ... state.hideFeedback = ",i.hideFeedback);i.hideFeedback?y.DisableFeedback():y.EnableFeedback()}function ls(){}function nr(){clearInterval(ai);ai=setInterval(()=>{if(it+=1e3,as(),t.debugMode){const n=new Date(it),t=String(n.getMinutes()).padStart(2,"0"),i=String(n.getSeconds()).padStart(2,"0");$(".taskTimerSpan").text("Tid: "+t+":"+i)}},1e3)}function tr(){clearInterval(ai)}function as(){let n=i.TaskObjectArray[i.currentTaskIndex],t=n[vt];n&&t.length>0&&n.taskFeedback(n.id,"time",{msecsSinceTaskStart:it})}function vs(){return i.TaskObjectArray[i.currentTaskIndex]}function ys(n){i.exerciseName=n.name}function ps(n){r("initSettings(), {jsonData, settings}:",{jsonData:n,settings:t});typeof n.exerciseSettingsModel!="undefined"&&(t.debugMode=n.exerciseSettingsModel?.exerciseDebugMode);typeof n.exerciseSettingsModel?.exerciseCustomCss!="undefined"&&(t.customCss=n.exerciseSettingsModel.exerciseCustomCss)}function ws(n){ks(n);h.GenerateExerciseHeader(n);h.GenerateExerciseIntroOverlay(n);h.GenerateExerciseMarkup(n)}function bs(n){ds(n);nh(n);th(n)}function ks(){let n=t.customCss;if(r("handleExerciseCustomCss, string",{customCssString:n,json:json,settings:t}),typeof n!="undefined"){let r=document.createElement("style");r.type="text/css";r.innerHTML=n;$(t.contentWrapSelector).append(r);i.customCssSheet=r}}function ds(n){const t=n[ui];r("generateExerciseTaskObject",n);t.forEach((n,t)=>{let r={};r.index=t;r[fi]=n[fi];r[ar]=n[ar];r[vr]=n[vr];r[at]=n[at];r[p]=n[p];r[vt]=n[vt];r[b]=n[b];r.callback=w;r.taskFeedback=y.ShowTaskFeedback;r.interactionFeedbackList=[y.ShowInteractionFeedback];r.userObject={taskLog:[],taskDetailObject:{}};i.TaskObjectArray.push(r)})}function gs(n){return n=lu(n),{left:n.x,top:n.y,width:n.width,height:n.height}}function nh(n){const t=n[ui];t.forEach(n=>{let r=n[p],t={};r.forEach(n=>{t[ei]=n[ei],t[yr]=n[yr],t[oi]=n[oi],t[pr]=n[pr],t.onCompleteId=n.onCompleteId,t.callback=y.ShowInteractionFeedback});i.InteractionArray.push(t)})}function th(n){const t=n[ui];t.forEach(n=>{let u=n[at],t=n[p],i=n[vt];i&&i.forEach(n=>{let c=n[ie],l=n[ci],a=n[ci][re],v=n[ci][ue],p=n[kr],f=n[kr][fe],w=n[li],b=n[li][ee],k=n[li][oe],d=n[g],e=n[g][se],nt=n[g][he],o=n[g][ce],s=n[g][le],h=n[g].callback;var i=new ITEM.FeedbackController.FeedbackItem(c);if(w?i.SetStyleType(b,k):i.SetStyleType(undefined,undefined),i.SetType("task",u),l?i.SetDisplay(a,v):i.SetDisplay("time",2e4),p&&f.length>0)i.SetInteractionHighlight(f);else{const n=[];t.forEach(t=>{const i=t.id;n.push(i)});i.SetInteractionHighlight(n)}d?nt==!0?i.SetDismiss(o,s,e,ru,h):i.SetDismiss(o,s,e,undefined,h):i.SetDismiss("auto","8000",undefined,!1,undefined);r("_feedbackArray - adding taskfeedback item:",i);y.AddFeedbackToArray(i)});t&&t.forEach(n=>{let i=n[ei],t=n[lf];r("interactionFeedbackList",t);t&&t.forEach(n=>{let u=n[af],c=n[vf],l=n[hi],a=n[hi][bf],v=n[hi][kf],p=n[si],w=n[si][yf],b=n[si][pf],f=n[br],k=n[br][wf],d=n[tt],g=n[tt][gf],e=n[tt][ne],o=n[tt][te],s=n[tt][df],h=n.dismiss.callback;var t=new ITEM.FeedbackController.FeedbackItem(c);u&&(t.id=u);l?t.SetStyleType(a,v):t.SetStyleType(undefined,undefined);t.SetType("interaction",i);p?t.SetDisplay(w,b):t.SetDisplay(undefined,undefined);f&&f.length>0?t.SetInteractionHighlight(k):t.SetInteractionHighlightAsArray(i);d?g==!0?t.SetDismiss(e,o,s,ru,h):t.SetDismiss(e,o,s,undefined,h):t.SetDismiss("auto","8000",undefined,!1,undefined);r("_feedbackArray - adding interaction item:",t);y.AddFeedbackToArray(t)})})})}function lu(n){let t=n;return Object.keys(t).forEach(n=>{typeof t[n]=="number"&&(t[n]=t[n]+"%")}),t}function ih(){r("initDebug",i);let f=document.createElement("span"),t=document.createElement("span"),n=document.createElement("span"),u=document.createElement("input"),e=document.createElement("span");rh();uh();$(t).addClass(["taskCountSpan","debug-tool"]);$(f).addClass(["taskTimerSpan","debug-tool"]);$(n).attr("id",lr).addClass("debug-tool");$(n).on("click",function(){let n=$(u).val();navigator.clipboard.writeText(n);r("copied to clipboard:",{copyValue:n});$(this).find("span").text(` --copied!`)});$(u).on("input",fh);$(t).text(`Opgave: ${i.currentTaskIndex+1}`);$("#debug--finish-exercise").on("click",hh);n.append(u,e);$(ef).append(t,f,n)}function rh(){}function uh(){if(h){let n=h?.GetHeaderBtn("bug_report",oo,{tooltip:"Debug Menu"}),t=h?.GetHeaderBtn("local_fire_department",sh,{tooltip:"Debug Sight"}),i=h?.GetHeaderBtn("image_aspect_ratio",oh,{tooltip:"Make Interaction Rectangles"}),r=h?.GetHeaderBtn("skip_next",yi,{tooltip:"Skip Task"});$(rt).append(t);$(rt).append(n);$(rt).append(i);$(rt).append(r)}}function fh(n){let i=$(`${or} .${cf}`),u=$(n.target).val(),f=u.replace(/(['"])?([a-z0-9A-Z_]+)(['"])?:/g,'"$2": '),r={};try{r=JSON.parse(f)}catch(e){eh(e,n)}let t=gs(r);t=lu(t);i.length>0&&i.css(t)}function eh(n){$(`#${lr} span`).text("Input JSON error.");r("JSON input error: ",{error:n})}function oh(){return $("body").toggleClass(hf),$(this).toggleClass(ri),i.isGeneratingRectanglesMode=!i.isGeneratingRectanglesMode,s(),d.ToggleReportRectangle(i.isGeneratingRectanglesMode,null),!1}function sh(){return $("body").toggleClass(sf),$(this).toggleClass(ri),!1}function hh(){i.didStart=!0;let n=Array.from($(ii));for(let t=0;t<n.length;t++)yi()}function r(n,i){t.debugMode&&console.log(n,i)}r("jsonData:",typeof n);const au="#intro-begin",rt=".exercise-header__tools-list",vu=".task-tool",ir="#exerciseSettings",rr="#prevTask",ut="#pauseTask",ft="#playTask",et="#enableAudio",ot="#disableAudio",ur="#skipTask",st="#enableSubtitles",ht="#disableSubtitles",ct="#replayAudio",yu="#restartExercise",pu="tools-list__item",c="hidden",wu="#debug-overlay",kt="#settings-overlay",fr="#results-overlay",dt="#unfocus-overlay",nt="#audio-error-overlay",gt="#intro-overlay",bu="#result-attempt-list",ni="#confirm-restart-overlay",ku="#confirm-restart-btn",du="#cancel-restart-btn",ti="#mute-checkbox",gu="#subtitles-checkbox-settings",nf="#feedback-checkbox",tf="feedback-component",rf=".feedback-wrapper",l="#subtitles",uf="#subtitles-hide",er="#subtitles-move",ii=".task",ff=".task:first",or=".task.active:first",f=".active",o=t.exerciseSelector,ch=t.navigation.selector,sr="task",u="hidden",e="active-overlay",hr="active-subtitles",lt="active",cr="paused",ri="active",ef="#exercise-debug-container",sf="debug-sight",hf="debug-record-rect",cf="mock-interaction",lr="debug-msg",ui="exerciseTaskModels",at="id",fi="audioFile",b="delay",ar="screenshot",vr="subtitles",p="interactionList",vt="feedbackList",ei="id",yr="name",oi="type",lf="feedbackList",pr="dimensions",wr="assessmentList",af="id",vf="text",si="display",yf="type",pf="threshold",br="highlight",wf="highlightInteraction",hi="feedbackType",bf="mood",kf="size",tt="dismiss",df="text",gf="doItForMe",ne="type",te="timeout",ie="text",ci="display",re="type",ue="threshold",kr="highlight",fe="highlightInteraction",li="feedbackType",ee="mood",oe="size",g="dismiss",se="text",he="doItForMe",ce="type",le="timeout";let dr=null,it=0,ai,k;var a,d,v,y,vi,h,i={jsonData:n,currentTaskObject:{},currentTaskId:new String,currentTaskIndex:0,exerciseAttemptCount:0,InteractionArray:[],TaskObjectArray:[],EventLog:[],didStart:!1,isFinished:!1,isPaused:!1,isShowingSettings:!1,isShowingResults:!1,hideFeedback:!1,isMuted:!1,isSubtitled:!0,isGeneratingRectanglesMode:!1};return this.Start=ye,this.GetCurrentTaskObject=vs,ve(),this};ITEM.AudioController=function(n){function t(t,i){n.debugMode&&console.log(t,i)}function i(){if(u()){t("PlayAudio (fileCheck FAILED)",audioControllerState);let r=audioControllerState.playAttemptCount,n=audioControllerState.audioObject.play();t("playAudio (start)",{audioObject:audioControllerState.audioObject,audioFile:audioControllerState.currentFile,attempts:r,promist:n});typeof n!="undefined"&&audioControllerState.currentFile!=""&&n.then(()=>{audioControllerState.playAttemptCount=0}).catch(u=>(audioControllerState.playAttemptCount<1?setTimeout(function(){t(`playAudio() : attempting to play audio at attempt #${r+1} `,n);i()},250):(t(`playAudio() : Could not play audiofile after ${r+1} attempts. Handling error:`,u),h(u)),audioControllerState.playAttemptCount>1?(f(),!1):void 0));audioControllerState.playAttemptCount++}}function e(){t("pauseAudio (audioPlayer.js)");audioControllerState.audioObject.pause()}function o(){t("replayAudio (audioPlayer.js)");audioControllerState.audioObject.currentTime=0;audioControllerState.audioObject.play()}function r(){t("stopAudio (audioPlayer.js)");audioControllerState.audioObject.currentTime=0;audioControllerState.audioObject.pause()}function s(n,i,r){audioControllerState.formerFile=audioControllerState.currentFile;audioControllerState.currentFile=n;audioControllerState.audioObject=new Audio(audioControllerState.currentFile);t("loadAudioFile",{audioObj:audioControllerState.audioObject,file:n,callback:i,duration:audioControllerState.audioObject.duration});audioControllerState.audioObject.addEventListener("play",function(){audioControllerState.isPlaying=!0;audioControllerState.isPaused=!1;r=="play"&&i()});audioControllerState.audioObject.addEventListener("pause",function(){audioControllerState.isPaused=!0;r=="pause"&&i()});audioControllerState.audioObject.addEventListener("ended",function(){audioControllerState.isPlaying=!1;audioControllerState.isPaused=!1;(r=="ended"||typeof r==undefined)&&i()})}function u(){return audioControllerState.currentFile!=""?!0:!1}function h(i){t("handleError (audio). Error:",{error:i,state:audioControllerState});switch(i.constructor){case DOMException:if(n.onDOMError!==undefined)n.onDOMError("Du skal lige interagere med din browser før vi må afspille lyden ...");else console.error(i);break;case SyntaxError:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i);break;case Error:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i);break;default:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i)}}function f(){r();audioControllerState.formerFile=audioControllerState.currentFile;audioControllerState.currentFile="";audioControllerState.audioObject=new Audio(audioControllerState.currentFile)}function c(){audioControllerState.audioObject.volume=0}function l(){audioControllerState.audioObject.volume=1}function a(){return audioControllerState}function v(){return audioControllerState.audioObject}function y(){return typeof audioControllerState.audioObject!="undefined"&&audioControllerState.audioObject!=null?audioControllerState.audioObject.src==""?audioControllerState.audioObject.duration:!1:!1}return audioControllerState={audioObject:new Audio,isPlaying:!1,isPaused:!1,currentFile:"",formerFile:"",playAttemptCount:0},this.PlayAudio=i,this.ReplayAudio=o,this.StopAudio=r,this.PauseAudio=e,this.FileCheck=u,this.LoadAudioFile=s,this.ClearAudioFile=f,this.MuteAudio=c,this.UnmuteAudio=l,this.GetAudioFileDuration=y,this.GetAudioObject=v,this.GetAudioControllerState=a,this};ITEM.MarkupController=function(n,t){function tt(){}function it(t){const i=t[p],r=$(n.exerciseSelector);i.forEach(t=>{let i=[],u=t[k],f=n.assetsPath+t[w],e=t[b];i.push(`
                <div class="${s}" id="${u}">
                <div class="${h}"></div>
                <img src="${f}" draggable="false">
                <div class="feedback-wrapper"></div>
                </div>
            `);r.append(i);for(let n of e){let f=n[d],r=n[g],e=n[nt],o=yt(e);const u=document.createElement("div");let i;r.length==0&&(r="none");r==="stringinput"?(i=document.createElement("input"),$(i).attr({type:"text",autocomplete:"off"})):i=document.createElement("span");$(u).css(o);$(i).attr("data-interaction",f);i.classList.add(r);u.append(i);$(`#${t.id}`).find(a).append(u)}})}function rt(t){t.forEach(t=>{let u=ut(t),f=t.exerciseTaskResultObjectArray,r=document.createElement("li"),i=document.createElement("ul");i.classList.add("result__task-list");f.forEach(t=>{let r=document.createElement("li");r.classList.add("result__item");r.setAttribute("data-task-index",t.index);let u=et(t),f=ft(t);r.append(u);r.append(f);n.showTaskOnlyOnAutocomplete?t.userDidAutoCompleteEvent&&i.append(r):i.append(r)});r.append(u);r.append(i);$(c).append(r)})}function ut(n){let t=document.createElement("div"),u=document.createElement("h2"),e=typeof n.index!="undefined"?`Forsøg nr. ${n.index+1}`:"",o=document.createTextNode(`${e} - Flot klaret `);u.append(o);let f=document.createElement("h3"),s=document.createTextNode(`Du har gennemført '${n.name}'. Vil du prøve igen?`);f.append(s);let h=document.createElement("p"),c=document.createTextNode(`Gennemsnitslig træfsikkerhed: ${n.exerciseMeanPrecision} % ${n.exerciseMeanPrecision<=50?" - Prøv lige en gang til.":""}`);h.append(c);let l=document.createElement("p"),a=document.createTextNode(`Antal interaktioner: ${n.exerciseInteractionCount}`);l.append(a);let p=document.createElement("p"),i=document.createElement("div"),v=document.createTextNode(`Du trykkede på 'Gør det for mig', og fik hjælp til en eller flere opgaver. Antal: ${n.exerciseAutocompleteCount}`),r=document.createElement("span"),y=document.createTextNode("warning");return r.classList.add("material-icons"),r.append(y),i.classList.add("alert","result__notice"),i.append(r,v),t.append(u,f),n.exerciseAutocompleteCount>0&&t.append(i),t}function ft(t){let i=document.createElement("div");if(i.classList.add("result__info"),n.showTaskAutocomplete&&t.userDidAutoCompleteEvent){let n=ot(t.userDidAutoCompleteEvent);i.append(n)}n.showTaskSubtitles&&t.subtitles!=null;let r=document.createElement("div"),u=document.createTextNode(`“ ${t.subtitles} ”`);if(r.append(u),r.classList.add("result__quote"),r.classList.add("info-item"),i.append(r),!t.userDidAutoCompleteEvent){let n=st();i.append(n)}if(n.showTaskAccuracy){let n=document.createElement("p"),r=document.createTextNode(`Træfsikkerhed: ${at(t.userPrecision,2)} % ${t.userPrecision<=50?"- Prøv igen.":""}`);n.append(r);i.append(n)}return i}function et(n){let t=document.createElement("summary"),i=document.createElement("h4"),r=document.createElement("span");n.index!=null;let u=document.createTextNode(`Opgave ${n.index+1}`);i.append(u);let f=document.createTextNode("expand_more");return r.classList.add("material-icons"),r.append(f),t.append(i),t}function ot(){let n=document.createElement("span");n.classList.add("alert");n.classList.add("info-item");let i=`Tryk på 'Gør det for mig'. Vil du prøve igen?`,t=document.createElement("span");t.classList.add("material-icons");let r=document.createTextNode("warning");return t.append(r),n.append(t),n.append(i),n}function st(){let t=document.createElement("span"),n=document.createElement("span");n.classList.add("material-icons");let i=document.createTextNode("done");return n.append(i),t.append(n),t}function ht(n,t,i={}){let u=document.createElement("li"),e=i.tooltip,r=document.createElement("a"),f=document.createElement("span"),s=document.createTextNode(n);if(typeof e=="string"&&r.setAttribute("title",e),f.classList.add("material-icons"),r.classList.add("task-tool"),r.setAttribute("href","#"),u.classList.add(o),f.appendChild(s),r.appendChild(f),u.appendChild(r),t)$(r).on("click",t);return u}function ct(n){$(r)&&$(r).append(n[e])}function lt(r){$(u)&&$(u).append(r[e]);$(f)&&$(f).html(r[v]);let s=t.TaskObjectArray.filter(n=>n.subtitles!=""),h=t.TaskObjectArray.filter(n=>n.audioFile!=""),o=r[y];if(o.length>0){$(i).find(".settings-check__item.audio-check").addClass("active-check");let u=$(i).find(".settings-check__item.audio-check:first a"),f=o,r=new Audio(n.assetsPath+f);r.addEventListener("ended",function(){u.removeClass("button--playing")});r.addEventListener("play",function(){u.addClass("button--playing")});u.on("click",function(){t.isMuted||r.play()});$(l).on("click",function(){r.pause()})}s.length>0&&$(i).find(".settings-check__item.subtitles-check:first").addClass("active-check")}function at(n,t){var i=Math.pow(10,t||0);return Math.round(n*i)/i}function vt(n){let t=n;return Object.keys(t).forEach(n=>{typeof t[n]=="number"&&(t[n]=t[n]+"%")}),t}function yt(n){return n=vt(n),{left:n.x,top:n.y,width:n.width,height:n.height}}n.showTaskOnlyOnAutocomplete=!0;n.showTaskSubtitles=!0;n.showTaskAccuracy=!1;n.showTaskAutocomplete=!0;const o="tools-list__item",s="task",h="interactions",c="#result-attempt-list",r="#exercise-header-title",u="#exercise-title",f="#exercise-description",l="#intro-begin",i="#intro-overlay",a=".interactions",e="name",v="description",y="audioFile",p="exerciseTaskModels",w="screenshot",b="interactionList",k="id",d="id",g="type",nt="dimensions";return tt(),this.GenerateExerciseMarkup=it,this.GenerateExerciseHeader=ct,this.GenerateExerciseIntroOverlay=lt,this.GenerateExerciseResultMarkup=rt,this.GetHeaderBtn=ht,this};ITEM.OverlayController=function(){return this};ITEM.FeedbackController=function(n,t,i){function e(n){u.push(n)}function o(i,e,o){if(r("showTaskFeedback (feedbackController.js)",{taskId:i,displayType:e,args:o,settings:t,feedbackArray:u}),t.showFeedback){const t=u.filter(n=>n.ScopeId===i&&n.Type==="task"&&n.DisplayType===e&&n.DisplayThreshold===o.msecsSinceTaskStart);r("showTaskFeedback (feedbackController.js), matchingFeedback:",t);t.length==1?f(t[0],n):t.length>1&&(r('Error: More than one instance of "matchingFeedback" was found when running showTaskfeedback()',t),f(t[0],n))}}function s(i,e,o){var s;if(r("showInteractionFeedback (feedbackController.js)",{interactionId:i,displayType:e,args:o}),t.showFeedback){switch(e){case"attempts":s=u.filter(n=>n.ScopeId===i&&n.Type==="interaction"&&n.DisplayType===e&&n.DisplayThreshold===o.interactionAttempts);break;case"correct":s=u.filter(n=>n.ScopeId===i&&n.Type==="interaction"&&n.DisplayType===e);s.length==0?o.callback?o.callback():r("Warning (FeedbackController): There's no feedback to display nor any callbacks. Please check InputController",s):o.callback?s[0].DismissCallback=o.callback:r("Warning (FeedbackController): There aren't any callbacks. Please check InputController",s)}if(r("showInteractionFeedback matchingFeedback",s),s.length==1)r("showInteractionFeedback matchingFeedback.length == 1",s),f(s[0],n);else if(s.length>1)for(let t=0;t<s.length;t++)r('Error: More than one instance of "matchingFeedback" was found when running showTaskfeedback()',{matchingFeedback:s,feedbackIndex:t}),f(s[t],n,o);else r("showInteractionFeedback NO FEEDBACK FOUND!",e)}}function f(n,u){function v(n,t){var e=document.createElement("p"),l,u,o,r,a,s,i,f,h;t.append(e);l=n.split(/(\[[^\]].*?\])/g);for(u of l)if(o=u.match(/(\[[^\]].*?\])/g),o)if(r=document.createElement("div"),r.classList.add("data-key-wrapper"),e.append(r),i=o[0].replace(/[\[\]]/g,""),i.includes("+")){a=i.split("+");s=[];for(i of a)s.push(`<div class="data-key">${c(i)}</div>`);f=s.join("+");r.innerHTML=f}else f=`<div class="data-key">${c(i)}</div>`,r.innerHTML=f;else u!=""&&(h=document.createElement("span"),e.append(h),h.innerHTML=u)}function c(n){return{up:"🠅",right:"🠆",down:"🠇",left:"🠄",shift:"⇧ shift",meta:"⌘",alt:"⌥ alt",backspace:"⌫ backspace","return":"⏎ enter",capsLock:"caps lock",tab:"↹ tab"}[n]||n}function o(){return $(this).parents("feedback-component").remove(),$(".highlight-area").removeClass("highlight-area"),n.DismissCallback&&n.DismissCallback(),!1}var f,s,e,h;r("setupFeedbackComp() (start)",{showFeedback:t.showFeedback,feedbackItem:n,wrapper:u});f=$(i.feedbackComponentSelector);f;f=document.createElement(i.feedbackComponentSelector);$(u).append(f);$(f).addClass([n.Mood,n.Size]);$(u).addClass([n.Mood,n.Size]);let l={id:$(i.activeTaskSelector).attr("id")},a={event:n,timeStamp:Date.now(),task:$(i.activeTaskSelector),explainer:`Feedback show because ${n.DisplayType} threshold of ${n.DisplayThreshold} reached. (text: "${n.Text}", dismissType: ${n.DismissType}, mood: ${n.Mood})`};if(_logController.HandleOutputLogEntry(l,a),n.InteractionHighlights.length>0){r("setupFeedbackComp() (InteractionHighlights.length > 0)",{showFeedback:t.showFeedback,feedbackItem:n,wrapper:u});for(s of n.InteractionHighlights){e=`[data-interaction="${s}"]`;$(e).is("input")&&(e=$(e).closest("div"));$(e).addClass("highlight-area");let t={id:$(".task.active").attr("id")},i={event:n,timeStamp:Date.now(),task:$(".task.active"),explainer:`Feedback HIGHLIGHT TEXT show because ${n.DisplayType} threshold of ${n.DisplayThreshold} reached. (text: "${n.Text}", dismissType: ${n.DismissType}, mood: ${n.Mood})`};r("setupFeedbackComp() highlight -- ",{highlightSelector:e,tObj:t,eObj:i});_logController.HandleOutputLogEntry(t,i)}}if(n.Text&&typeof n.Text!="undefined"&&n.Text.length>0&&v(n.Text,$(f)),n.DismissType=="manual"){const i=document.createElement("div"),t=document.createElement("a");$(f).append(i);$(i).addClass("btn-wrapper").append(t);t.classList.add("dismiss-feedback");t.classList.add("button");t.innerText=n.DismissBtnText||"Ok";$(t).on("click",o)}else h=n.DismissTimeout||8e3,setTimeout(()=>o(),h);if(n.DoItForMe!=undefined){const t=document.createElement("a"),i=document.createElement("div");$(f).append(i);$(i).addClass("btn-wrapper").append(t);t.classList.add("doItForMe");t.classList.add("button");t.innerText="Gør det for mig";$(t).on("click",()=>(o(),n.DoItForMe(),$(t).remove(),!1))}}function h(){r("disableFeedback");$("feedback-component").addClass("hidden");t.showFeedback=!1}function c(){r("enableFeedback");$("feedback-component").removeClass("hidden");t.showFeedback=!0}function l(){$("feedback-component").remove()}function r(n,i){t.debugMode===!0&&console.log(n,i);typeof t.logController=="Object"}function a(){r("handleRestartExercise (feedbackController)");l()}_logController=t.logController;t.showFeedback=!0;const u=[];return this.FCHandleRestartExercise=a,this.EnableFeedback=c,this.DisableFeedback=h,this.AddFeedbackToArray=e,this.ShowTaskFeedback=o,this.ShowInteractionFeedback=s,this};ITEM.FeedbackController.FeedbackItem=function(n){function t(n,t){this.Mood=n;this.Size=t}function i(n,t){this.Type=n;this.ScopeId=t}function r(n,t){this.DisplayType=n;this.DisplayThreshold=t}function u(n){this.InteractionHighlights.push(n)}function f(n){this.InteractionHighlights.concat(n)}function e(n,t,i,r,u){this.DismissType=n;this.DismissTimeout=t;this.DismissBtnText=i;this.DoItForMe=r;this.DismissCallback=u}return this.ScopeId,this.Type,this.DisplayType,this.DisplayThreshold,this.Text=n,this.InteractionHighlights=[],this.DismissType,this.DismissTimeout,this.DismissBtnText,this.DismissCallback,this.Mood,this.Size,this.DoItForMe,this.SetStyleType=t,this.SetType=i,this.SetDisplay=r,this.SetInteractionHighlightAsArray=u,this.SetInteractionHighlight=f,this.SetDismiss=e,this};ITEM.InputController=function(n){function rt(n){InputControllerState.currentTaskObject=n;t("inputcontroller init",InputControllerState.currentTask);si();hi(InputControllerState.currentTask)}function ut(i){InputControllerState.currentTask=$(n.exerciseContainerSelector).find(c);InputControllerState.currentTaskObject=i;t("initTask (inputcontroller)",{taskObj:i,currentTask:InputControllerState.currentTask});l(i)}function l(){w();fi();b();t("initNewTaskInteraction (inputController)",InputControllerState);a();ft(InputControllerState.currentTask);lt();r("Task Start.","status")}function ft(n){Array.from(n.find("input")).forEach(n=>{let t={id:n.getAttribute("id"),value:n.value};InputControllerState.taskInputfieldArray.push(t)});setTimeout(function(){n.find("input:first").trigger("focus")},100)}function a(){vt();at();typeof InputControllerState.currentTaskObject!="undefined"&&InputControllerState.currentTaskObject[u].forEach(n=>{InputControllerState.interactionObjectArray.push(n)})}function et(n){InputControllerState.currentClickEvent=n;InputControllerState.currentClickTarget=n.target;t("mouseClickHandler",n);gt(n);InputControllerState.isReportingRectangles?li(n):h(n)}function ot(n){InputControllerState.currentRightClickEvent=n;InputControllerState.currentRightClickEvent=n.target;ni(n);h(n)}function st(n){InputControllerState.currentDblClickEvent=n;InputControllerState.currentDblClickTarget=n.target;ti(n);h(n)}function ht(n){n.preventDefault();n.stopPropagation();t("keyUpHandler (START):",{exerciseHasFocus:$("#assetContentWrapper").is(":focus").toString(),event:n});ct(n);ii(n);yt(n)}function t(t,i){n.debugMode&&console.log(t,i)}function ct(n){if(InputControllerState.shiftKey=n.shiftKey,InputControllerState.ctrlKey=n.ctrlKey,InputControllerState.altKey=n.altKey,InputControllerState.currentKey=n.key,n.key.length<2){let t=InputControllerState.currentStringInstance+n.key;InputControllerState.currentStringInstance=t}else if(n.key.length>1){let n=InputControllerState.currentStringInstance+"*";InputControllerState.currentStringInstance=n}}function lt(n){let e=InputControllerState.currentTaskObject[u].filter(n=>n[o]==g);t("initMouseOver",{task:n,currentTask:InputControllerState.currentTaskObject,state:InputControllerState,mouseoverObjects:e});e.forEach(n=>{t("initMouseOver iObj",n);let h=$(`#${InputControllerState.currentTaskObject[f]}`),e=n[f],o=n[i],u=h.find(`[data-interaction='${e}']`),s=1;u.on("mouseover",function(n){if(u.hasClass("mouseover")){let f={event:n,timeStamp:Date.now(),explainer:`Brugeren bevægede musen over et element: ${u.prop("nodeName")}`,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,type:"mouseover"};t("Mouseover event",f);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,f);r("Task Complete.","status",s);typeof o!="undefined"&&o.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{n(e,"correct",{interactionAttempts:s,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()}})})}function at(){InputControllerState.interactionObjectArray=[]}function vt(){InputControllerState.currentStringInstance=""}function v(r){if(InputControllerState.interactionCount++,!n.discreteFeedback)for(let n=0;n<InputControllerState.currentTaskObject[u].length;n++){let e=InputControllerState.currentTaskObject[u][n],s=e[o],f=e.id;t("! discreteFeedback",{event:r,iObj:e,interactionCount:InputControllerState.interactionCount});switch(s){case"click":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount,iObj:e})});break;case"dblclick":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;case"rightclick":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;case"keydown":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount,iObj:e})});break;case"stringinput":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;default:InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})})}}}function h(n){if(t("checkMouseInteraction (start)",n),typeof InputControllerState.currentTaskObject!="undefined"&&InputControllerState.currentTask!=null&&InputControllerState.currentTask.hasClass("active")&&$(n.target).parents(".feedback-wrapper").length==0){for(let t=0;t<InputControllerState.currentTaskObject[u].length;t++){let i=InputControllerState.currentTaskObject[u][t],r=i[o];switch(r){case"click":n.which==1?bt(n,i):!1;break;case"dblclick":n.type=="dblclick"?dt(n,i):!1;break;case"rightclick":n.which==3?kt(n,i):!1}}v(n)}}function yt(n){if(t("checkKeyboardInteraction (event):",n),typeof InputControllerState.currentTaskObject!="undefined"&&InputControllerState.currentTask!=null&&InputControllerState.currentTask.hasClass("active")){for(let i=0;i<InputControllerState.currentTaskObject[u].length;i++){let r=InputControllerState.currentTaskObject[u][i],f=r[o];t("checkKeyboardInteraction (foreach iObj)",{iObj:r,interactionType:r.type,InputControllerStatecurrentTaskObject:InputControllerState.currentTaskObject});switch(f){case"keydown":n.type!="mousedown"&&$(n.target).is(":not(input)")&&(t("checkKeyboardInteraction (interactionType:)",f),pt(n,r));break;case"stringinput":n.type!="mousedown"&&$(n.target).is("input")&&wt(n,r)}}v(n)}}function y(n,t){for(let i of t){let t=0;for(let r of n)if(i.includes(r)&&(t++,t==i.length))return!0}return!1}function p(n){let t=[];return t.push(n.key),InputControllerState.flavorKeys.forEach(i=>{switch(i){case"Control":n.ctrlKey&&t.push(i);break;case"Alt":n.altKey&&t.push(i);break;case"Shift":n.shiftKey&&t.push(i)}}),t}function pt(u,f){if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptKeyCount++;let e=f[s],o=InputControllerState.currentTaskObject[i],h=f.id;if(typeof e!="undefined"&&e.length>0)for(let s=0;s<e.length;s++){let c=e[s],l=c.correctInput;if(t(`checkMatchKeyPress (assessment loop: #${s})`,{iObj:f,assessment:c}),typeof l!="undefined"){let e=InputControllerState.taskAttemptKeyCount,s=[],c=[];s=p(u);l.forEach(n=>c.push(n.split("+")));let a=y(s,c);a?(t("checkMatchKeyPress [CORRECT]",InputControllerState.currentTaskObject),r("Task Complete.","status",e),typeof o!="undefined"&&o.length>0?(t("checkMatchKeyPress [CORRECT, HAS FEEDBACK]:",o),o.forEach(n=>{t("checkMatchKeyPress [CORRECT, LOOPING FEEDBACK]:",n),n(h,"correct",{interactionAttempts:e,callback:InputControllerState.currentTaskObject.callback})})):(t("checkMatchKeyPress [CORRECT, NO FEEDBACK]",f),InputControllerState.currentTaskObject.callback())):n.discreteFeedback&&(t("checkMatchKeyPress [WRONG]",InputControllerState.currentTaskObject[d]),InputControllerState.currentTaskObject[i].forEach(n=>{t("checkMatchKeyPress [WRONG], feedback",n),n(h,"attempts",{interactionAttempts:e})}))}else t("CheckMatchKeyPress ERROR: (assessment correctKey not specified!)",c),InputControllerState.currentTaskObject.callback()}}else t("Error (Input Controller): No task object found.",u)}function wt(u,e){let c=$(u.target),a=c.attr("data-interaction"),o=e[f],l=e[s],h=e[i];if(t("checkMatchString() ",{iObj:e}),a==o&&typeof l!="undefined"&&l.length>0)for(let f=0;f<l.length;f++){let w=e[s][f],l=w[nt],v=w[tt],b=w[it];if(l.length>0&&(typeof v=="undefined"||v.length==0)){t("checkMatchString (no attemptTrigger)");let n=InputControllerState.currentStringInstance.length,u=l.find(n=>n==c.val()),f=l.reduce(function(n,t){return n.length>t.length?n:t});u?(r("Task Complete.","status",n),typeof h!="undefined"&&h.length>0?InputControllerState.currentTaskObject[i].forEach(t=>{t(o,"correct",{interactionAttempts:n,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n>f.length&&InputControllerState.currentTaskObject[i].forEach(t=>{t(o,"attempts",{interactionAttempts:n})})}else if(l.length>0&&typeof v!="undefined")for(let f=0;f<v.length;f++){let s=v[f];if(typeof s=="string"){let f=[];f.push(s.split("+"));let v=p(u),w=y(v,f);if(w){InputControllerState.taskAttemptInputfieldInputCount++;let u=InputControllerState.taskAttemptInputfieldInputCount;if(a==o){let f=!1;f=b?l.find(n=>n==c.val()):l.find(n=>n.toLowerCase()==c.val().toLowerCase());f?(r("Task Complete.","status",u),t("checkMatchString (correctInput)",e),typeof h!="undefined"&&h.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"correct",{interactionAttempts:u,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):(t("checkMatchString (wrong Input)",e),n.discreteFeedback&&InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"attempts",{interactionAttempts:u})}))}}}else if(typeof s=="number"){let f=InputControllerState.taskKeyDownLogArray.filter(n=>n.event.target.nodeName=="INPUT");InputControllerState.taskAttemptInputfieldInputCount++;let t=InputControllerState.taskAttemptInputfieldInputCount,u=w.correctInput.find(n=>n==c.val());u?(r("Task Complete.","status",t),typeof h!="undefined"&&h.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"correct",{interactionAttempts:t,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"attempts",{interactionAttempts:t})})}}}}function bt(u,e){let o=u.target,h=o.getAttribute("data-interaction"),s=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptClickCount++;let f=InputControllerState.taskAttemptClickCount;t("checkMatchClick (start)",{event:u,attempts:f,target:o});u.type=="mousedown"&&typeof h!="undefined"&&s==h&&$(o).hasClass("click")?(r("Task Complete.","status",f),typeof c!="undefined"&&c.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{n(s,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&(t("checkMatchClick (WRONG)",{event:u,attempts:f,interactionFeedback:InputControllerState.currentTaskObject[i]}),InputControllerState.currentTaskObject[i].forEach(n=>{n(s,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function kt(u,e){let s=u.target,h=s.getAttribute("data-interaction"),o=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptRightClickCount++;let f=InputControllerState.taskAttemptRightClickCount;u.which==3&&typeof h!="undefined"&&o==h&&$(s).hasClass("rightclick")?(r("Task Complete.","status",f),typeof c!="undefined"&&c.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&(t("checkMatchRightClick (WRONG) feedback",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function dt(u,e){let h=u.target,s=h.getAttribute("data-interaction"),o=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptDblclickCount++;InputControllerState.taskAttemptClickCount--;InputControllerState.taskAttemptClickCount--;let f=InputControllerState.taskAttemptDblclickCount;u.type=="dblclick"&&typeof s!="undefined"&&o==s&&$(h).hasClass("dblclick")?(r("Task Complete.","status",f),t("dblClick correct!",{interactionId:o,targetId:s}),typeof c!="undefined"&&c.length>0?(t("dblClick (running through interactionFeedbackList",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{t("dblClick feedback (correct)",n),n(o,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})})):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&(t("checkMatchDblClick (WRONG) feedback",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{n(o,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function gt(t){let o=$(n.exerciseContainerSelector).width(),s=$(n.exerciseContainerSelector).height(),i=t.pageX-t.currentTarget.offsetLeft,r=t.pageY-t.currentTarget.offsetTop,f=Math.round(i/o*100),e=Math.round(r/s*100),u={timeStamp:Date.now(),event:t,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren klikkede på en < ${t.target.nodeName} > med klassen '${t.target.getAttribute("class")}' og ID '${t.target.getAttribute("id")}'. Pixel-Koordinater: ( ${i} ; ${r} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:i,relativeY:r,relativeXpc:f,relEventYpc:e,type:"click"};InputControllerState.taskEventLogArray.push(u);InputControllerState.taskMouseDownLogArray.push(u);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,u)}function ni(t){let o=$(n.exerciseContainerSelector).width(),s=$(n.exerciseContainerSelector).height(),i=t.pageX-t.currentTarget.offsetLeft,r=t.pageY-t.currentTarget.offsetTop,f=Math.round(i/o*100),e=Math.round(r/s*100),u={timeStamp:Date.now(),event:t,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren HØJRE-klikkede på en < ${t.target.nodeName} > med klassen '${t.target.getAttribute("class")}' og ID '${t.target.getAttribute("id")}'. Pixel-Koordinater: ( ${i} ; ${r} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:i,relativeY:r,relativeXpc:f,relEventYpc:e,type:"contextmenu"};InputControllerState.taskEventLogArray.push(u);InputControllerState.taskRightClickLogArray.push(u);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,u)}function ti(t){let o=$(n.exerciseContainerSelector).width(),s=$(n.exerciseContainerSelector).height(),i=t.pageX-t.currentTarget.offsetLeft,r=t.pageY-t.currentTarget.offsetTop,f=Math.round(i/o*100),e=Math.round(r/s*100),u={timeStamp:Date.now(),event:t,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren DOBBELT-klikkede på en < ${t.target.nodeName} > med klassen '${t.target.getAttribute("class")}' og ID '${t.target.getAttribute("id")}'. Pixel-Koordinater: ( ${i} ; ${r} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:i,relativeY:r,relativeXpc:f,relEventYpc:e,type:"dblclick"};InputControllerState.taskEventLogArray.push(u);InputControllerState.taskDblClickLogArray.push(u);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,u)}function ii(n){let i=[];InputControllerState.taskInputfieldArray.forEach(n=>{let t={};for(let i in n)t[i]=n[i];i.push(t)});let t={timeStamp:Date.now(),event:n,task:InputControllerState.currentTask,taskObject:InputControllerState.currentTaskObject,InputFields:i,currentString:InputControllerState.currentStringInstance,currentKey:n.key,explainer:`Brugeren trykkede på tasten [${n.key}] ${n.altKey?"+ [ALT]":""} ${n.shiftKey?"+[SHIFT]":""} ${n.ctrlKey?"+[CTRL]":""}`,type:"key"};InputControllerState.taskKeyDownLogArray.push(t);InputControllerState.taskEventLogArray.push(t);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,t)}function ri(n){const t=n.target;if(t&&n){const i=t.getBoundingClientRect(),r=n.clientX-i.left,u=n.clientY-i.top,f=r/i.width*100,e=u/i.height*100;return{relX:r,relY:u,relXpercent:f,relYpercent:e}}return!1}function r(n,t,i=null){let r={event:n,timeStamp:Date.now(),explainer:`${n}`,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,type:t};i!=null&&(r.attemptCount=i);InputControllerState.taskEventLogArray.push(r);_logController.HandleSecretLogEntry(InputControllerState.currentTaskObject,r)}function ui(){return{allEvents:InputControllerState.taskEventLogArray,keyDown:InputControllerState.taskKeyDownLogArray,InputFields:InputControllerState.taskInputfieldArray,mouseDown:InputControllerState.taskMouseDownLogArray,dblClick:InputControllerState.taskDblClickLogArray}}function w(){InputControllerState.taskEventLogArray=[];InputControllerState.taskKeyDownLogArray=[];InputControllerState.taskInputfieldArray=[];InputControllerState.taskMouseDownLogArray=[];InputControllerState.taskDblClickLogArray=[]}function fi(){InputControllerState.currentClickEvent=null;InputControllerState.currentClickTarget=null;InputControllerState.currentDblClickEvent=null;InputControllerState.currentDblClickTarget=null;InputControllerState.currentKey=null;InputControllerState.currentKeySequence=[];InputControllerState.currentString=null;InputControllerState.currentStringInstance=null}function ei(){t("clearInputFields (inputController.js)");$(n.exerciseContainerSelector).find("input").val("")}function b(){InputControllerState.interactionCount=0;InputControllerState.taskAttemptInputfieldInputCount=0;InputControllerState.taskAttemptKeyCount=0;InputControllerState.taskAttemptDblclickCount=0;InputControllerState.taskAttemptClickCount=0;InputControllerState.taskAttemptRightClickCount=0}function oi(){t("handleRestartExercise (inputcontroller)",InputControllerState);ei();b()}function si(){$(n.exerciseContainerSelector).off();let t=$("#assetContentWrapper .task:first");t.parent().off()}function hi(){let i=$("#assetContentWrapper .task:first");if(t("initGlobalEventListeners",{task:i,taskObject:InputControllerState.currentTaskObject}),n.keyDownDetect)$(i).parent().on("keyup",ht);if(n.mouseDownDetect){$(i).parent().on("mousedown",et);$(i).parent().on("contextmenu",ot)}if(n.dblClickDetect)$(i).parent().on("dblclick",st)}function ci(n,i){t("toggleReportRectangle",{isOn:n,target:i,InputControllerState:InputControllerState});InputControllerState.isReportingRectangles=n;InputControllerState.reportTarget=i}function li(n){t("reportRectangle(event) : ",n);let r=InputControllerState.rectangleObjectArray,i=InputControllerState.rectanglePointArray,u=ri(n);if(n.target.nodeName=="IMG"&&i.length<2&&($(`${e} input`).html("... klik igen ..."),i.push(u)),i.length>=2){let t={p0:i[0],p1:i[1]},n=ai(t);r.push(n);yi(n);InputControllerState.rectanglePointArray=[]}return!1}function ai(n){let t=n.p0.relXpercent,r=n.p1.relXpercent,i=n.p0.relYpercent,u=n.p1.relYpercent;t>r&&(t=n.p1.relXpercent,r=n.p0.relXpercent);i>u&&(i=n.p1.relYpercent,u=n.p0.relYpercent);let f=r-t,e=u-i;return{x:t,y:i,w:f,h:e}}function vi(n){let t="";if(n){let i=n.x,r=n.y,u=n.w,f=n.h;t=`{x:${i}, y:${r}, width:${u}, height:${f}}`}return t}function yi(n){let t=n;Object.keys(t).forEach(t=>{typeof n[t]=="number"&&(n[t]=bi(n[t],4))});let i=vi(t);$(`${e} input`).html(i);$(`${e} input`).val(i);$(`${e} span`).html("");$(e).removeClass("blink-change");$(e).addClass("blink-change");wi(n)}function pi(n){return Object.keys(n).forEach(t=>{typeof n[t]=="number"&&(n[t]=n[t]+"%")}),{left:n.x,top:n.y,width:n.w,height:n.h}}function wi(n){let u=pi(n),t=$(c).find(k),i=document.createElement("div"),r="mock-interaction";t.find(`.${r}`).remove();$(i).css(u).addClass(r);t.append(i)}function bi(n,t){var i=Math.pow(10,t||0);return Math.round(n*i)/i}_logController=n.logController;const c=".task.active:first",k=".interactions",d="taskFeedbackList",f="id",u="interactionList",s="assessmentList",i="interactionFeedbackList",o="type",g="mouseover",nt="correctInput",tt="attemptTrigger",it="caseSensitive",e="#debug-msg";return InputControllerState={currentTask:null,interactionObjectArray:[],currentClickEvent:null,currentClickTarget:null,currentDblClickEvent:null,currentDblClickTarget:null,currentKeySequence:[],currentKey:null,currentStringInstance:typeof n.initialString!="undefined"?n.initialString:"",storedStringArray:n.initialStoredStringArray?n.initialStoredStringArray:[],interactionCount:0,taskAttemptInputfieldInputCount:0,taskAttemptKeyCount:0,taskAttemptDblclickCount:0,taskAttemptClickCount:0,taskAttemptRightClickCount:0,taskEventLogArray:[],taskMouseDownLogArray:[],taskRightClickLogArray:[],taskDblClickLogArray:[],taskKeyDownLogArray:[],taskInputfieldArray:[],flavorKeys:["Control","Shift","Alt"],isReportingRectangles:!1,reportTarget:null,rectanglePointArray:[],rectangleObjectArray:[]},this.InitInputController=rt,this.InitNewTaskInteraction=l,this.InitInteractionArray=a,this.InitTask=ut,this.StdLogEntry=r,this.GetEventLog=ui,this.ClearTaskEventLog=w,this.ICHandleRestartExercise=oi,this.ToggleReportRectangle=ci,this};ITEM.LogController=function(n,t){function e(){r({logID:"INIT",logEvent:[{timeStamp:Date.now(),explainer:"LOG CONTROLLER INIT",type:"status",task:null,taskObject:null,event:null}],logComment:null})}function u(t){n.debugMode&&(typeof t.event=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.event == undefined). Please specify event.",t),typeof t.timeStamp=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.timeStamp == undefined). Please set timestamp.",t),typeof t.task=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.task == undefined). Please specify current task.",t))}function o(n,t,f){u(t);let e={logID:n.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"input",logComment:f};r(e,i)}function s(n,t,f){u(t);let e={logID:n.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"output",logComment:f};r(e,i)}function h(n,t,f){u(t);let e={logID:n.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"secret",logComment:f};r(e,i)}function r(n,r){let u=r||i;u.push(n);t.push(n)}function c(n){let t=n.id,i=f(t);n.userObject.taskLog=i}function f(n){return i.filter(t=>t.logID==n)}function l(){return i}this.settings=n||{};let i=[];return e(),this.HandleInputLogEntry=o,this.HandleOutputLogEntry=s,this.HandleSecretLogEntry=h,this.StoreLogEntry=r,this.StoreLogEntriesToTask=c,this.GetLogsById=f,this.GetLogs=l,this};ITEM.ResultsController=function(n,t){function i(){}function r(n){let i=[],r=[...n],t=[0];r.forEach((n,i)=>{n.logEvent.event=="Exercise Complete."&&t.push(i)});for(let n=1;n<t.length;n++){let u=t[n-1],f=t[n],e=r.slice(u+1,f+1);i.push(e)}return i}function u(n){let t=[],i=n.EventLog,u=r(i);return u.forEach((i,r)=>{let h=i.filter(n=>n.logType=="secret"),c=i.filter(n=>n.logType=="output"),p=i.filter(n=>n.logType=="input"),l=h.filter(n=>n.logEvent.event=="Task Complete."),f=c.filter(n=>n.logEvent.event=="Task Auto-Completed."),a=f.length,v=n.exerciseName,e=i[0].logEvent.timeStamp,o=i[i.length-1].logEvent.timeStamp,s=o-e,y=s/1e3,w=l.length/0,u={index:r,name:v,exerciseStartTime:e,exerciseEndTime:o,exerciseTimeSpentMs:s,exerciseTimeSpendSeconds:y,exerciseMeanPrecision:null,exerciseAutocompleteCount:a,exerciseAutoCompleteEvents:f,allUserEvents:[],exerciseTaskResultObjectArray:[]};i.forEach(n=>{let t=!1,i=null,r=null;n.logEvent.event=="Task Auto-Completed."&&(t=!0);typeof n.logEvent.taskObject!="undefined"&&(i=n.logEvent.taskObject.index);typeof n.logEvent.taskObject!="undefined"&&(r=n.logEvent.taskObject.subtitles);u.allUserEvents.push(n);let f={eventType:n.eventType,logEntry:n,userDidAutoCompleteEvent:t,index:i,subtitles:r};u.exerciseTaskResultObjectArray.push(f)});t.push(u)}),t}function f(){let n=[];return t.TaskObjectArray.forEach(t=>{let i={},r=t.userObject.taskLog,e=r[0].logTimeStamp,o=r[r.length-1].logTimeStamp,u=o-e,s=u/1e3,f=t.userObject.taskLog.filter(n=>n.logEvent.event.originalEvent instanceof KeyboardEvent||n.logEvent.event.originalEvent instanceof MouseEvent),h=Math.round(100/f.length,3),c=t.userObject.taskLog.filter(n=>n.logEvent.event=="Task Auto-Completed.").length>0;i.index=t.index;i.userDidAutoCompleteEvent=c;i.timeSpentMs=u;i.timeSpentSeconds=s;i.userPrecision=h;i.screenshot=t.screenshot;i.userEvents=f;i.subtitles=t.subtitles;n.push(i)}),n}function e(){}function o(){}const s=n.exerciseSelector;return i(),this.GetExerciseResultObjectArray=u,this.PrepareTaskResultArray=f,this.PrepareExerciseIntroOverlay=o,this.GenerateExerciseResults=e,this};