function startExercise(n){if(typeof n=="undefined")mapJsonToExerciseJson(function(n){let t=new ITEM.Exercise(n,{contentWrapSelector:"#assetContentWrapper",exerciseSelector:"#assetContentWrapper .task__list",defaultAreaInstructionDelay:5e3,autoHideAreaErrorInstructionsAfter:5e3,help:!0,assetsPath:"",showIntro:!0,navigation:{selector:"#nav",allowPreviousTask:!0,allowNextTask:!0}});t.Start()},function(n){console.error("Unable to load exercise JSON:",n)});else{let t=new ITEM.Exercise(n,{contentWrapSelector:"#assetContentWrapper",exerciseSelector:"#assetContentWrapper .task__list",defaultAreaInstructionDelay:5e3,autoHideAreaErrorInstructionsAfter:5e3,help:!0,assetsPath:"",showIntro:!0,navigation:{selector:"#nav",allowPreviousTask:!0,allowNextTask:!0}});t.Start()}}function mapJsonToExerciseJson(n,t){var i=$.getJSON({url:"assets/json/umbraco-test.json",success:function(t){let i=JSON.parse(JSON.stringify(t));typeof n=="function"?n(i):console.error("No success callback specified.")},error:function(n){typeof t=="function"?t(n):console.error("No error callback specified.")}})}const ITEM={};ITEM.Exercise=function(n,t){function be(){i.didStart=!1;i.isFinished=!1;i.isPaused=!1;i.isShowingSettings=!1;i.isShowingResults=!1}function ke(){r("start");t.showIntro||i.didStart?tu():(nu=new Date,i.didStart=!0,w?.InitInputController(i.TaskObjectArray[i.currentTaskIndex]),vt())}function de(){r("init Exercise.js");no().then(uo()).then(ge()).then(io()).then(to()).then(ro()).then(iu(),eh());c()}function ge(n=i.jsonData){i.exerciseName=n.name}async function no(n=i.jsonData){r("initSettings(), {jsonData, settings}:",{jsonData:n,settings:t});typeof n.exerciseSettingsModel!="undefined"&&(t.debugMode=n.exerciseSettingsModel?.exerciseDebugMode);typeof n.exerciseSettingsModel?.exerciseCustomCss!="undefined"&&(t.customCss=n.exerciseSettingsModel.exerciseCustomCss)}function to(n=i.jsonData){nc(n);o.GenerateExerciseHeader(n);o.GenerateExerciseIntroOverlay(n);o.GenerateExerciseMarkup(n)}function io(n=i.jsonData){ih(n);uh(n);fh(n)}function ro(){let n=i.TaskObjectArray[i.currentTaskIndex];if(n&&n!==void 0){w?.InitInputController(n);$(ur).on("click",es);$(fr).on("click",oo);$(rt).on("click",yt);$(ut).on("click",pt);$(er).on("click",pi);$(ht).on("click",ks);$(ft).on("click",os);$(et).on("click",ss);$(ot).on("click",hs);$(st).on("click",cs);$(bu).on("click",ls);$(gu).on("click",as);$(nf).on("click",bi);$(kt).on("click",function(){pt();$(s).focus()});$(ni).on("click",nr);$(uf).on("click",fs);$(ff).on("click",gs);$(hf).on("click",rs);$(sr).on("click",us);$(s).attr("tabindex","0").trigger("focus").on("focusout",ao).on("focus",lo)}else rr()}function tu(){$(dt).addClass(e);$(dt).find(pu).on("click",ys)}async function uo(){v=ITEM.LogController({debugMode:t.debugMode},i.EventLog);w=ITEM.InputController({exerciseContainerSelector:s,dblClickDetect:!0,mouseDownDetect:!0,keyDownDetect:!0,logController:v,debugMode:t.debugMode});y=ITEM.AudioController({onDOMError:ps,debugMode:t.debugMode});h=ITEM.FeedbackController(`${s} ${ti}${f} ${sf}`,{debugMode:t.debugMode,logController:v,exerciseController:this},{feedbackComponentSelector:ef,activeTaskSelector:hr});yi=ITEM.ResultsController(t,i,{});o=ITEM.MarkupController(t,i,{debugMode:t.debugMode});r("init controllers from exercise.js",{logController:v,inputController:w,audioController:y,feedbackController:h,resultController:yi,markupController:o})}function iu(){i.currentTaskIndex=0;typeof i.TaskObjectArray[0]!="undefined"&&i.TaskObjectArray[0]?(i.currentTaskId=i.TaskObjectArray[0][lt],i.currentTaskObject=i.TaskObjectArray[0]):ru();$(t.exerciseSelector).find(ti).removeClass(ct);$(t.exerciseSelector).find(cf).addClass(ct)}function vt(){let n=i.TaskObjectArray[i.currentTaskIndex];n!==void 0&&n?!i.isFinished&&i.didStart&&w&&(r("initTask (Exercise.js)",i.TaskObjectArray[i.currentTaskIndex]),$(f).before().find("input")&&$(s).trigger("focus"),w.InitTask(n),cu(),ws(),hu(),di(),fu(),fo()):ru()}function ru(){let n={currentState:i,errorLocation:"inittask",errortype:"Object"};rr(n)}function fo(){let n=i.TaskObjectArray[i.currentTaskIndex];if(n!==void 0&&n){if(!i.isFinished&&i.didStart){r("startTask",n);let u=typeof n!="undefined"?n[k]:[],i=typeof n!="undefined"?n[ei]:0,f=0;f&&f!=""||(f=0);let t=0;t&&t!=""||(t=0);u.length==0&&i==0?t=500:u.length==0&&i!=0&&(t=i);let e=window.setTimeout(function(){(typeof t=="undefined"||t)&&ds();nh("proceedTimer",e);tr()},f);vu();lu();gi();u.length==0&&i==0&&(r("startTask (task issues, no interaction && delay)"),setTimeout(p,t));u.length==0&&i>0&&(r("startTask (no interactions, auto-proceed)",t),setTimeout(p,t))}}else eo();c()}function eo(){let n={currentState:i,errorLocation:"starttask",errortype:"Object"};rr(n)}function p(){if(!i.isFinished&&i.didStart){let n={timeSpentOnTask:tt};r("OnTaskEnd",n);au();uu()}}function yt(){if(!i.isFinished&&i.didStart&&!i.isPaused){i.isPaused=!0;yo();bs();ir();wt();let n={event:"Pause Task",timeStamp:Date.now(),task:$(s).find(f),explainer:"Paused Task."};v.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],n)}r("pauseTask, current EventLog:",i.EventLog);c()}function pt(){if(!i.isFinished&&!i.isShowingSettings&&i.didStart&&i.isPaused){let n=$(t.exerciseSelector).find(f);i.isPaused=!1;r("resumeTask",n);su();n.find("input").length>0?n.find("input").trigger("focus"):$(s).is(":focus")||$(s).trigger("focus");hu();i.isSubtitled&&di();gi();tr();c();let u={event:"Resume Task",timeStamp:Date.now(),task:$(s).find(f),explainer:"Resumed Task."};v.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],u)}}function pi(){if(!i.isFinished&&i.didStart){let n={event:"Skip Task",timeStamp:Date.now(),task:$(s).find(f),explainer:"Brugeren sprang opgavedelen over."};v.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],n);au();uu()}}function oo(){if(ki(),!i.isFinished&&i.didStart){let n=$(t.exerciseSelector).find(f);i.currentTaskIndex>-1&&!n.is(":first-of-type")?(i.currentTaskIndex--,t.debugMode&&$(`.${vr}`).text(`Opgave: ${i.currentTaskIndex+1}`),n.find("input:first").val(""),n.removeClass().addClass(cr),n.prev().addClass(ct),vt()):r("First Task - can not go back.")}}function uu(){let n=$(t.exerciseSelector).find(f),u=i.TaskObjectArray[i.currentTaskIndex];ki();!i.isFinished&&i.didStart&&(i.currentTaskIndex++,r("goToNextTask (start)",n),t.debugMode&&$(`.${vr}`).text(`Opgave: ${i.currentTaskIndex+1}`),u==i.TaskObjectArray[i.TaskObjectArray.length]||n.is(":last-child")?ho():(n.removeClass().addClass(cr),n.next().addClass(ct),i.currentTask=$(t.exerciseSelector).find(f),vt()))}function fu(){r("cleanTask()");$(".show-click-effect").removeClass("show-click-effect");$(".show-keydown-effect").remove();clearTimeout(b);ir();tt=0}function eu(){var o,s,u,n,h,e,a,l,t,c;r("autoCompleteTask (start)",i.TaskObjectArray);i.TaskObjectArray[i.currentTaskIndex].userObject.taskDetailObject.autoComplete=!0;let y={event:"Task Auto-Completed.",timeStamp:Date.now(),task:i.TaskObjectArray[i.currentTaskIndex],explainer:"User autocompleted/skipped task."};v.HandleOutputLogEntry(i.TaskObjectArray[i.currentTaskIndex],y,"User autocompleted/skipped task.");for(o of i.TaskObjectArray[i.currentTaskIndex][k])switch(o[si]){case"stringinput":for(n of o[kr])if(n.correctInput[0]!=undefined){$(f+" input:first").val("");s=n.correctInput[0];u=0;function t(){u<s.length?($(f+" input:first").val($(f+" input:first").val()+s[u]),u++,setTimeout(t,75)):u===s.length&&(b=setTimeout(p,400))}t()}break;case"click":$(f+" .click:first").addClass("show-click-effect");b=setTimeout(p,1200);break;case"dblclick":$(f+" .dblclick:first").addClass("show-click-effect");b=setTimeout(p,1200);break;case"mouseover":$(f+" .mouseover:first").addClass("show-click-effect");b=setTimeout(p,1200);break;case"rightclick":$(f+" .rightclick:first").addClass("show-click-effect");b=setTimeout(p,1200);break;case"keydown":for(n of o[kr])if(n.correctInput!=undefined){t=n.correctInput;h=document.createElement("div");h.classList.add("show-keydown-effect");e=document.createElement("div");e.classList.add("data-key-wrapper");$(f+":first").append(h);$(h).append(e);function i(n){return{up:"🠅",right:"🠆",down:"🠇",left:"🠄",shift:"⇧ shift",meta:"⌘",alt:"⌥ alt",backspace:"⌫ backspace","return":"⏎ enter",capsLock:"caps lock",tab:"↹ tab"}[n]||n}if(t.includes("+")){a=t.split("+");l=[];for(t of a)l.push(`<div class="data-key">${i(t)}</div>`);c=l.join("+");e.innerHTML=c}else c=`<div class="data-key">${i(t)}</div>`,e.innerHTML=c}b=setTimeout(p,600)}}function so(){r("restartExercise",i);su();be();w.ICHandleRestartExercise();h.FCHandleRestartExercise();iu();tu();i.exerciseAttemptCount++}function ho(){i.isFinished=!0;r("handleEndExercise",i);let n={event:"Exercise Complete.",timeStamp:Date.now(),task:i.TaskObjectArray[i.currentTaskIndex],explainer:"User completed the exercise."};v.HandleOutputLogEntry(i.TaskObjectArray[i.TaskObjectArray.length-1],n,"Exercise Complete.");cu();ki();wt();fu();co();vs()}function co(){let n=yi?.GetExerciseResultObjectArray(i);ns();ko();o?.GenerateExerciseResultMarkup(n)}function lo(){r("handleFocus",{showingResults:i.isShowingResults,pause:i.isPaused});pt()}function ao(n){r("handleUnfocus",{isSubtitles:$(n.relatedTarget).is(a),event:n,relatedTarget:n.relatedTarget});$(n.relatedTarget).is($(t.exerciseSelector))&&wi();$(n.relatedTarget).is(wu)&&wi();($(n.relatedTarget).parents(a).length>0||$(n.relatedTarget).is(a))&&wi();i.isShowingResults||$(s).is(".ignore-unfocus")||$(n.relatedTarget).is("input")||yt();$(s).removeClass("ignore-unfocus")}function wi(){$(s).addClass("ignore-unfocus");$(s).trigger("focus")}function vo(){$(g).addClass(e)}function ou(){$(g).removeClass(e)}function yo(){$(kt).addClass(e);$("body").addClass(ar)}function po(){$("body").removeClass(ar);$(kt).removeClass(e)}function wo(){i.isShowingSettings=!i.isShowingSettings;$(bt).toggleClass(e)}function bo(){return $(ku).toggleClass(e),$(this).toggleClass(ii),!1}function ko(){i.isShowingResults=!0;$(or).toggleClass(e)}function go(){i.isShowingResults=!1;$(or).removeClass(e)}function ns(){$(du).html("")}function ts(){i.isShowingSettings=!1;$(bt).removeClass(e)}function is(){$(gt).addClass(e)}function bi(){$(gt).removeClass(e)}function su(){bi();go();po();ou();ts()}function rs(){return wt(),!1}function hu(){let t=i.TaskObjectArray[i.currentTaskIndex],n=t?.subtitles;r("loadTaskSubtitles",{currentTask:t,subtitles:n});i.isSubtitled&&typeof n!="undefined"&&n!=null&&n!=""&&($(a).addClass(lr),$(a).find("p:first").html(n))}function ki(){r("clearTaskSubtitles");$(a).removeClass(lr);$(a).find("p:first").html("")}function us(){return r("moveTaskSubtitles()",sr),$(a).toggleClass("moved"),!1}function fs(){i.isSubtitled=!i.isSubtitled;c()}function di(){return $(a).removeClass(u),!1}function wt(){return $(a).addClass(u),!1}function c(){i.isFinished?($(exerciseSettings).addClass(u),$(ht).addClass(u)):($(exerciseSettings).removeClass(u),$(ht).removeClass(u));i.isPaused?($(rt).addClass(u),$(ut).removeClass(u)):($(ut).addClass(u),$(rt).removeClass(u));i.isMuted?($(ft).removeClass(u),$(et).addClass(u)):($(ft).addClass(u),$(et).removeClass(u));i.isSubtitled?($(ot).addClass(u),$(st).removeClass(u)):($(ot).removeClass(u),$(st).addClass(u))}function es(){yt();wo()}function os(){return nr(),c(),!1}function ss(){return nr(),c(),!1}function hs(){i.isSubtitled=!0;di();c()}function cs(){i.isSubtitled=!1;wt();c()}function ls(){$(gt).hasClass(e)?bi():(yt(),is())}function as(){return r("handleRestartExerciseConfirmBtn",i),so(),!1}function vs(){$(fr).addClass(l);$(rt).addClass(l);$(ut).addClass(l);$(er).addClass(l);$(ft).addClass(l);$(et).addClass(l);$(ot).addClass(l);$(st).addClass(l);$(ht).addClass(l);$(ur).addClass(l)}function ys(n){r("handlerBeginExerciseBtn",n);n.preventDefault();nu=new Date;i.didStart=!0;$(dt).removeClass(e);vt()}function ps(n){ir();vo();$(g).find(".error-action:first").html("Tryk her for at prøve igen.");$(g).find(".error-detail:first").html(n);$(g).on("click",function(){ou();gi();tr()})}function cu(){y?.ClearAudioFile()}function ws(){let n=typeof i.TaskObjectArray[i.currentTaskIndex]!="undefined"?i.TaskObjectArray[i.currentTaskIndex]:null,r=n!=null?n[fi]:"";y?.LoadAudioFile(t.assetsPath+r)}function gi(){r("playTaskAudioFile");y?.PlayAudio()}function bs(){y?.PauseAudio()}function ks(){r("replayTaskAudioFile (exercise.js)",i);i.isFinished||(y.ReplayAudio(),pt())}function nr(){i.isMuted=!i.isMuted;lu();c()}function lu(){i.isMuted?y?.MuteAudio():y?.UnmuteAudio()}function au(){let n=i.TaskObjectArray[i.currentTaskIndex];v?.StoreLogEntriesToTaskObject(n)}function ds(){}function gs(){i.hideFeedback=!i.hideFeedback;vu();c()}function vu(){r("handleFeedbackState() ... state.hideFeedback = ",i.hideFeedback);i.hideFeedback?h?.DisableFeedback():h?.EnableFeedback()}function nh(){}function tr(){clearInterval(vi);vi=setInterval(()=>{if(tt+=1e3,th(),t.debugMode){const n=new Date(tt),t=String(n.getMinutes()).padStart(2,"0"),i=String(n.getSeconds()).padStart(2,"0");$(`.${pf}`).text("Tid: "+t+":"+i)}},1e3)}function ir(){clearInterval(vi)}function th(){let n=i.TaskObjectArray[i.currentTaskIndex],t=n[at];n&&typeof n.taskFeedback!="undefined"&&t.length>0&&n.taskFeedback(n.id,"time",{msecsSinceTaskStart:tt})}function ih(n){const t=n[ui];r("generateExerciseTaskObject",n);t.forEach((n,t)=>{let r={};r.index=t;r[fi]=n[fi];r[yr]=n[yr];r[pr]=n[pr];r[lt]=n[lt];r[k]=n[k];r[at]=n[at];r[ei]=n[ei];r.callback=p;r.taskFeedback=h?.ShowTaskFeedback;r.interactionFeedbackList=[h?.ShowInteractionFeedback];r.userObject={taskLog:[],taskDetailObject:{}};i.TaskObjectArray.push(r)})}function rh(n){return n=yu(n),{left:n.x,top:n.y,width:n.width,height:n.height}}function uh(n){const t=n[ui];t.forEach(n=>{let r=n[k],t={};r.forEach(n=>{t[oi]=n[oi],t[wr]=n[wr],t[si]=n[si],t[br]=n[br],t.onCompleteId=n.onCompleteId,t.callback=h?.ShowInteractionFeedback});i.InteractionArray.push(t)})}function fh(n){const t=n[ui];t.forEach(n=>{let u=n[lt],t=n[k],i=n[at];i&&h&&i.forEach(n=>{let l=n[oe],a=n[li],v=n[li][se],y=n[li][he],p=n[gr],f=n[gr][ce],w=n[ai],b=n[ai][le],k=n[ai][ae],g=n[d],e=n[d][ve],nt=n[d][ye],o=n[d][pe],s=n[d][we],c=n[d].callback;var i=new ITEM.FeedbackController.FeedbackItem(l);if(w?i.SetStyleType(b,k):i.SetStyleType(undefined,undefined),i.SetType("task",u),a?i.SetDisplay(v,y):i.SetDisplay("time",2e4),p&&f.length>0)i.SetInteractionHighlight(f);else{const n=[];t.forEach(t=>{const i=t.id;n.push(i)});i.SetInteractionHighlight(n)}g?nt==!0?i.SetDismiss(o,s,e,eu,c):i.SetDismiss(o,s,e,undefined,c):i.SetDismiss("auto","8000",undefined,!1,undefined);r("_feedbackArray - adding taskfeedback item:",i);h.AddFeedbackToArray(i)});t&&h&&t.forEach(n=>{let i=n[oi],t=n[wf];r("interactionFeedbackList",t);t&&t.forEach(n=>{let u=n[bf],l=n[kf],a=n[ci],v=n[ci][te],y=n[ci][ie],p=n[hi],w=n[hi][df],b=n[hi][gf],f=n[dr],k=n[dr][ne],d=n[nt],g=n[nt][ue],e=n[nt][fe],o=n[nt][ee],s=n[nt][re],c=n.dismiss.callback;var t=new ITEM.FeedbackController.FeedbackItem(l);u&&(t.id=u);a?t.SetStyleType(v,y):t.SetStyleType(undefined,undefined);t.SetType("interaction",i);p?t.SetDisplay(w,b):t.SetDisplay(undefined,undefined);f&&f.length>0?t.SetInteractionHighlight(k):t.SetInteractionHighlightAsArray(i);d?g==!0?t.SetDismiss(e,o,s,eu,c):t.SetDismiss(e,o,s,undefined,c):t.SetDismiss("auto","8000",undefined,!1,undefined);r("_feedbackArray - adding interaction item:",t);h.AddFeedbackToArray(t)})})})}function eh(){t.debugMode&&(r("initDebug",i),sh(),hh(),oh())}function oh(){$("#debug--finish-exercise").on("click",wh)}function sh(){if(o){r("initDebugDisplays");let n=o.GetDebugMsgInput(ch,lh),t=o.GetDebugTaskTimer("00:00"),i=o.GetDebugTaskCount();$(ri).append(t);$(ri).append(i);$(ri).append(n)}}function hh(){if(o){let n=o?.GetHeaderBtn("bug_report",bo,{tooltip:"Debug Menu"}),t=o?.GetHeaderBtn("local_fire_department",ph,{tooltip:"Debug Sight"}),i=o?.GetHeaderBtn("image_aspect_ratio",yh,{tooltip:"Make Interaction Rectangles"}),r=o?.GetHeaderBtn("skip_next",pi,{tooltip:"Skip Task"});$(it).append(t);$(it).append(n);$(it).append(i);$(it).append(r)}}function ch(n){if($(n.target).val().length>0){let t=$(n.target).val();navigator.clipboard.writeText(t);r("copied to clipboard:",{copyValue:t});$(n.target).next().text(` --copied!`)}}function lh(n){ah(n)}function ah(n){let i=$(`${hr} .${vf}`),u=$(n.target).val(),f=u.replace(/(['"])?([a-z0-9A-Z_]+)(['"])?:/g,'"$2": '),r={};try{r=JSON.parse(f)}catch(e){vh(e,n)}let t=rh(r);t=yu(t);i.length>0&&i.css(t)}function vh(n){$(`#${yf} span`).text("Input JSON error.");r("JSON input error: ",{error:n})}function yh(){return $("body").toggleClass(af),$(this).toggleClass(ii),i.isGeneratingRectanglesMode=!i.isGeneratingRectanglesMode,c(),w?.ToggleReportRectangle(i.isGeneratingRectanglesMode,null),!1}function ph(){return $("body").toggleClass(lf),$(this).toggleClass(ii),!1}function wh(){i.didStart=!0;let n=Array.from($(ti));for(let t=0;t<n.length;t++)pi()}function r(n,i){t.debugMode&&console.log(n,i)}function rr(n){r("handleObjectError()",{state:i,errorObject:n});bh(n)}function bh(n){r("exerciseShortCircuit()",{state:i,errorObject:n});dh(n);kh()}function kh(){$(tf).addClass(e)}function dh(n){let t;t=n?.errortype!=void 0?`Fejl: ${n.errortype}`:`Ukendt Fejl`;$(rf).text(t)}function gh(){return i.TaskObjectArray[i.currentTaskIndex]}function yu(n){let t=n;return Object.keys(t).forEach(n=>{typeof t[n]=="number"&&(t[n]=t[n]+"%")}),t}function nc(){let n=t.customCss;if(r("handleExerciseCustomCss, string",{customCssString:n,json:json,settings:t}),typeof n!="undefined"&&n){let r=document.createElement("style");r.type="text/css";r.innerHTML=n;$(t.contentWrapSelector).append(r);i.customCssSheet=r}}r("jsonData:",typeof n);const pu="#intro-begin",it=".exercise-header__tools-list",wu=".task-tool",ur="#exerciseSettings",fr="#prevTask",rt="#pauseTask",ut="#playTask",ft="#enableAudio",et="#disableAudio",er="#skipTask",ot="#enableSubtitles",st="#disableSubtitles",ht="#replayAudio",bu="#restartExercise",l="hidden",ku="#debug-overlay",bt="#settings-overlay",or="#results-overlay",kt="#unfocus-overlay",g="#audio-error-overlay",dt="#intro-overlay",du="#result-attempt-list",gt="#confirm-restart-overlay",gu="#confirm-restart-btn",nf="#cancel-restart-btn",tf="#shortcircuit-overlay",rf="#shortcircuit-overlay-msg",ni="#mute-checkbox",uf="#subtitles-checkbox-settings",ff="#feedback-checkbox",ef="feedback-component",sf=".feedback-wrapper",a="#subtitles",hf="#subtitles-hide",sr="#subtitles-move",ti=".task",cf=".task:first",hr=".task.active:first",f=".active",s=t.exerciseSelector,tc=t.navigation.selector,cr="task",u="hidden",e="active-overlay",lr="active-subtitles",ct="active",ar="paused",ii="active",ri="#exercise-debug-container",lf="debug-sight",af="debug-record-rect",vf="mock-interaction",yf="debug-msg",pf="debug__task-timer",vr="debug__task-count",ui="exerciseTaskModels",lt="id",fi="audioFile",ei="delay",yr="screenshot",pr="subtitles",k="interactionList",at="feedbackList",oi="id",wr="name",si="type",wf="feedbackList",br="dimensions",kr="assessmentList",bf="id",kf="text",hi="display",df="type",gf="threshold",dr="highlight",ne="highlightInteraction",ci="feedbackType",te="mood",ie="size",nt="dismiss",re="text",ue="doItForMe",fe="type",ee="timeout",oe="text",li="display",se="type",he="threshold",gr="highlight",ce="highlightInteraction",ai="feedbackType",le="mood",ae="size",d="dismiss",ve="text",ye="doItForMe",pe="type",we="timeout";let nu=null,tt=0,vi,b;var v,w,y,h,yi,o,i={jsonData:n,currentTaskObject:{},currentTaskId:new String,currentTaskIndex:0,exerciseAttemptCount:0,InteractionArray:[],TaskObjectArray:[],EventLog:[],didStart:!1,isFinished:!1,isPaused:!1,isShowingSettings:!1,isShowingResults:!1,hideFeedback:!1,isMuted:!1,isSubtitled:!0,isGeneratingRectanglesMode:!1};return this.Start=ke,this.GetCurrentTaskObject=gh,de(),this};ITEM.AudioController=function(n){function t(t,i){n.debugMode&&console.log(t,i)}function i(){if(u()){t("PlayAudio (fileCheck FAILED)",audioControllerState);let r=audioControllerState.playAttemptCount,n=audioControllerState.audioObject.play();t("playAudio (start)",{audioObject:audioControllerState.audioObject,audioFile:audioControllerState.currentFile,attempts:r,promist:n});typeof n!="undefined"&&audioControllerState.currentFile!=""&&n.then(()=>{audioControllerState.playAttemptCount=0}).catch(u=>(audioControllerState.playAttemptCount<1?setTimeout(function(){t(`playAudio() : attempting to play audio at attempt #${r+1} `,n);i()},250):(t(`playAudio() : Could not play audiofile after ${r+1} attempts. Handling error:`,u),h(u)),audioControllerState.playAttemptCount>1?(f(),!1):void 0));audioControllerState.playAttemptCount++}}function e(){t("pauseAudio (audioPlayer.js)");audioControllerState.audioObject.pause()}function o(){t("replayAudio (audioPlayer.js)");audioControllerState.audioObject.currentTime=0;audioControllerState.audioObject.play()}function r(){t("stopAudio (audioPlayer.js)");audioControllerState.audioObject.currentTime=0;audioControllerState.audioObject.pause()}function s(n,i,r){audioControllerState.formerFile=audioControllerState.currentFile;audioControllerState.currentFile=n;audioControllerState.audioObject=new Audio(audioControllerState.currentFile);t("loadAudioFile",{audioObj:audioControllerState.audioObject,file:n,callback:i,duration:audioControllerState.audioObject.duration});audioControllerState.audioObject.addEventListener("play",function(){audioControllerState.isPlaying=!0;audioControllerState.isPaused=!1;r=="play"&&i()});audioControllerState.audioObject.addEventListener("pause",function(){audioControllerState.isPaused=!0;r=="pause"&&i()});audioControllerState.audioObject.addEventListener("ended",function(){audioControllerState.isPlaying=!1;audioControllerState.isPaused=!1;(r=="ended"||typeof r==undefined)&&i()})}function u(){return audioControllerState.currentFile!=""?!0:!1}function h(i){t("handleError (audio). Error:",{error:i,state:audioControllerState});switch(i.constructor){case DOMException:if(n.onDOMError!==undefined)n.onDOMError("Du skal lige interagere med din browser før vi må afspille lyden ...");else console.error(i);break;case SyntaxError:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i);break;case Error:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i);break;default:if(n.onDOMError!==undefined)n.onDOMError("Der er noget galt med lydfilen. Kontakt en kursusadminstrator.");else console.error(i)}}function f(){r();audioControllerState.formerFile=audioControllerState.currentFile;audioControllerState.currentFile="";audioControllerState.audioObject=new Audio(audioControllerState.currentFile)}function c(){audioControllerState.audioObject.volume=0}function l(){audioControllerState.audioObject.volume=1}function a(){return audioControllerState}function v(){return audioControllerState.audioObject}function y(){return typeof audioControllerState.audioObject!="undefined"&&audioControllerState.audioObject!=null?audioControllerState.audioObject.src==""?audioControllerState.audioObject.duration:!1:!1}return audioControllerState={audioObject:new Audio,isPlaying:!1,isPaused:!1,currentFile:"",formerFile:"",playAttemptCount:0},this.PlayAudio=i,this.ReplayAudio=o,this.StopAudio=r,this.PauseAudio=e,this.FileCheck=u,this.LoadAudioFile=s,this.ClearAudioFile=f,this.MuteAudio=c,this.UnmuteAudio=l,this.GetAudioFileDuration=y,this.GetAudioObject=v,this.GetAudioControllerState=a,this};ITEM.MarkupController=function(n,t){function ft(){}function et(t){const i=t[d],r=$(n.exerciseSelector);i.forEach(t=>{let i=[],u=t[tt],f=n.assetsPath+t[g],e=t[nt];i.push(`
                <div class="${h}" id="${u}">
                <div class="${c}"></div>
                <img src="${f}" draggable="false">
                <div class="feedback-wrapper"></div>
                </div>
            `);r.append(i);for(let n of e){let f=n[it],r=n[rt],e=n[ut],o=ni(e);const u=document.createElement("div");let i;r.length==0&&(r="none");r==="stringinput"?(i=document.createElement("input"),$(i).attr({type:"text",autocomplete:"off"})):i=document.createElement("span");$(u).css(o);$(i).attr("data-interaction",f);i.classList.add(r);u.append(i);$(`#${t.id}`).find(w).append(u)}})}function ot(t){t.forEach(t=>{let u=st(t),f=t.exerciseTaskResultObjectArray,r=document.createElement("li"),i=document.createElement("ul");i.classList.add("result__task-list");f.forEach(t=>{let r=document.createElement("li");r.classList.add("result__item");r.setAttribute("data-task-index",t.index);let u=ct(t),f=ht(t);r.append(u);r.append(f);n.showTaskOnlyOnAutocomplete?t.userDidAutoCompleteEvent&&i.append(r):i.append(r)});r.append(u);r.append(i);$(y).append(r)})}function st(n){let t=document.createElement("div"),u=document.createElement("h2"),e=n?.index!=void 0?`Forsøg nr. ${n.index+1}`:"",o=document.createTextNode(`${e} - Flot klaret `);u.append(o);let f=document.createElement("h3"),s=document.createTextNode(`Du har gennemført '${n.name}'. Vil du prøve igen?`);f.append(s);let h=document.createElement("p"),c=document.createTextNode(`Gennemsnitslig træfsikkerhed: ${n.exerciseMeanPrecision} % ${n.exerciseMeanPrecision<=50?" - Prøv lige en gang til.":""}`);h.append(c);let l=document.createElement("p"),a=document.createTextNode(`Antal interaktioner: ${n.exerciseInteractionCount}`);l.append(a);let p=document.createElement("p"),i=document.createElement("div"),v=document.createTextNode(`Du trykkede på 'Gør det for mig', og fik hjælp til en eller flere opgaver. Antal: ${n.exerciseAutocompleteCount}`),r=document.createElement("span"),y=document.createTextNode("warning");return r.classList.add("material-icons"),r.append(y),i.classList.add("alert","result__notice"),i.append(r,v),t.append(u,f),n.exerciseAutocompleteCount>0&&t.append(i),t}function ht(t){let i=document.createElement("div");if(i.classList.add("result__info"),n.showTaskAutocomplete&&t.userDidAutoCompleteEvent){let n=lt(t.userDidAutoCompleteEvent);i.append(n)}n.showTaskSubtitles&&t.subtitles!=null;let r=document.createElement("div"),u=document.createTextNode(`“ ${t.subtitles} ”`);if(r.append(u),r.classList.add("result__quote"),r.classList.add("info-item"),i.append(r),!t.userDidAutoCompleteEvent){let n=at();i.append(n)}if(n.showTaskAccuracy){let n=document.createElement("p"),r=document.createTextNode(`Træfsikkerhed: ${dt(t.userPrecision,2)} % ${t.userPrecision<=50?"- Prøv igen.":""}`);n.append(r);i.append(n)}return i}function ct(n){let t=document.createElement("summary"),i=document.createElement("h4"),r=document.createElement("span");n.index!=null;let u=document.createTextNode(`Opgave ${n.index+1}`);i.append(u);let f=document.createTextNode("expand_more");return r.classList.add("material-icons"),r.append(f),t.append(i),t}function lt(){let n=document.createElement("span");n.classList.add("alert");n.classList.add("info-item");let i=`Tryk på 'Gør det for mig'. Vil du prøve igen?`,t=document.createElement("span");t.classList.add("material-icons");let r=document.createTextNode("warning");return t.append(r),n.append(t),n.append(i),n}function at(){let t=document.createElement("span"),n=document.createElement("span");n.classList.add("material-icons");let i=document.createTextNode("done");return n.append(i),t.append(n),t}function vt(n,t,i={}){let u=document.createElement("li"),e=i.tooltip,r=document.createElement("a"),f=document.createElement("span"),o=document.createTextNode(n);if(typeof e=="string"&&r.setAttribute("title",e),f.classList.add("material-icons"),r.classList.add("task-tool"),r.setAttribute("href","#"),u.classList.add(s),f.appendChild(o),r.appendChild(f),u.appendChild(r),t)$(r).on("click",t);return u}function yt(n){$(u)&&$(u).append(n[o])}function pt(i){$(f)&&$(f).append(i[o]);$(e)&&$(e).html(i[b]);let s=t.TaskObjectArray.filter(n=>n.subtitles!=""),h=t.TaskObjectArray.filter(n=>n.audioFile!=""),u=i[k];if(u.length>0){$(r).find(".settings-check__item.audio-check").addClass("active-check");let f=$(r).find(".settings-check__item.audio-check:first a"),e=u,i=new Audio(n.assetsPath+e);i.addEventListener("ended",function(){f.removeClass("button--playing")});i.addEventListener("play",function(){f.addClass("button--playing")});f.on("click",function(){t.isMuted||i.play()});$(p).on("click",function(){i.pause()})}s.length>0&&$(r).find(".settings-check__item.subtitles-check:first").addClass("active-check")}function wt(n,t){let r=document.createElement("div"),u=document.createElement("input"),f=document.createElement("span");if($(r).attr("id",v).addClass(i),typeof n=="function")$(u).on("input",t);if(typeof t=="function")$(u).on("click",n);return $(r).append(u),$(r).append(f),r}function bt(n){let t=document.createElement("span");return $(t).addClass([i,a]),n&&$(t).text(n),t}function kt(n=1){let t=document.createElement("span");return $(t).addClass([i,l]),typeof n=="number"?$(t).text(`Opgave: ${n}`):$(t).text(`Opgave: ...`),t}function dt(n,t){var i=Math.pow(10,t||0);return Math.round(n*i)/i}function gt(n){let t=n;return Object.keys(t).forEach(n=>{typeof t[n]=="number"&&(t[n]=t[n]+"%")}),t}function ni(n){return n=gt(n),{left:n.x,top:n.y,width:n.width,height:n.height}}n.showTaskOnlyOnAutocomplete=!0;n.showTaskSubtitles=!0;n.showTaskAccuracy=!1;n.showTaskAutocomplete=!0;const s="tools-list__item",h="task",c="interactions",i="debug__tool",l="debug__task-count",a="debug__task-timer",v="debug-msg",y="#result-attempt-list",u="#exercise-header-title",f="#exercise-title",e="#exercise-description",p="#intro-begin",r="#intro-overlay",w=".interactions",o="name",b="description",k="audioFile",d="exerciseTaskModels",g="screenshot",nt="interactionList",tt="id",it="id",rt="type",ut="dimensions";return ft(),this.GenerateExerciseMarkup=et,this.GenerateExerciseHeader=yt,this.GenerateExerciseIntroOverlay=pt,this.GenerateExerciseResultMarkup=ot,this.GetDebugMsgInput=wt,this.GetDebugTaskCount=kt,this.GetDebugTaskTimer=bt,this.GetHeaderBtn=vt,this};ITEM.OverlayController=function(){return this};ITEM.FeedbackController=function(n,t,i){function e(n){u.push(n)}function o(i,e,o){if(r("showTaskFeedback (feedbackController.js)",{taskId:i,displayType:e,args:o,settings:t,feedbackArray:u}),t?.showFeedback){const t=u.filter(n=>n.ScopeId===i&&n.Type==="task"&&n.DisplayType===e&&n.DisplayThreshold===o.msecsSinceTaskStart);r("showTaskFeedback (feedbackController.js), matchingFeedback:",t);t.length==1?f(t[0],n):t.length>1&&(r('Error: More than one instance of "matchingFeedback" was found when running showTaskfeedback()',t),f(t[0],n))}}function s(i,e,o){var s;if(r("showInteractionFeedback (feedbackController.js)",{interactionId:i,displayType:e,args:o}),t?.showFeedback){switch(e){case"attempts":s=u.filter(n=>n.ScopeId===i&&n.Type==="interaction"&&n.DisplayType===e&&n.DisplayThreshold===o.interactionAttempts);break;case"correct":s=u.filter(n=>n.ScopeId===i&&n.Type==="interaction"&&n.DisplayType===e);s.length==0?o.callback?o.callback():r("Warning (FeedbackController): There's no feedback to display nor any callbacks. Please check InputController",s):o.callback?s[0].DismissCallback=o.callback:r("Warning (FeedbackController): There aren't any callbacks. Please check InputController",s)}if(r("showInteractionFeedback matchingFeedback",s),s.length==1)r("showInteractionFeedback matchingFeedback.length == 1",s),f(s[0],n);else if(s.length>1)for(let t=0;t<s.length;t++)r('Error: More than one instance of "matchingFeedback" was found when running showTaskfeedback()',{matchingFeedback:s,feedbackIndex:t}),f(s[t],n,o);else r("showInteractionFeedback NO FEEDBACK FOUND!",e)}}function f(n,u){function a(n,t){var e=document.createElement("p"),l,u,o,r,a,s,i,f,c;t.append(e);l=n.split(/(\[[^\]].*?\])/g);for(u of l)if(o=u.match(/(\[[^\]].*?\])/g),o)if(r=document.createElement("div"),r.classList.add("data-key-wrapper"),e.append(r),i=o[0].replace(/[\[\]]/g,""),i.includes("+")){a=i.split("+");s=[];for(i of a)s.push(`<div class="data-key">${h(i)}</div>`);f=s.join("+");r.innerHTML=f}else f=`<div class="data-key">${h(i)}</div>`,r.innerHTML=f;else u!=""&&(c=document.createElement("span"),e.append(c),c.innerHTML=u)}function h(n){return{up:"🠅",right:"🠆",down:"🠇",left:"🠄",shift:"⇧ shift",meta:"⌘",alt:"⌥ alt",backspace:"⌫ backspace","return":"⏎ enter",capsLock:"caps lock",tab:"↹ tab"}[n]||n}function e(){return $(this).parents("feedback-component").remove(),$(".highlight-area").removeClass("highlight-area"),n.DismissCallback&&n.DismissCallback(),!1}var f,o,s;r("setupFeedbackComp() (start)",{showFeedback:t.showFeedback,feedbackItem:n,wrapper:u});f=$(i.feedbackComponentSelector);f=document.createElement(i.feedbackComponentSelector);$(u).append(f);$(f).addClass([n.Mood,n.Size]);$(u).addClass([n.Mood,n.Size]);let c={id:$(i.activeTaskSelector).attr("id")},l={event:n,timeStamp:Date.now(),task:$(i.activeTaskSelector),explainer:`Feedback show because ${n.DisplayType} threshold of ${n.DisplayThreshold} reached. (text: "${n.Text}", dismissType: ${n.DismissType}, mood: ${n.Mood})`};if(_logController.HandleOutputLogEntry(c,l),n?.InteractionHighlights?.length>0){r("setupFeedbackComp() (InteractionHighlights.length > 0)",{showFeedback:t.showFeedback,feedbackItem:n,wrapper:u});for(o of n.InteractionHighlights){let t=`[data-interaction="${o}"]`;$(t).is("input")&&(t=$(t).closest("div"));$(t).addClass("highlight-area");let i={id:$(".task.active").attr("id")},u={event:n,timeStamp:Date.now(),task:$(".task.active"),explainer:`Feedback HIGHLIGHT TEXT show because ${n.DisplayType} threshold of ${n.DisplayThreshold} reached. (text: "${n.Text}", dismissType: ${n.DismissType}, mood: ${n.Mood})`};r("setupFeedbackComp() highlight -- ",{highlightSelector:t,tObj:i,eObj:u});_logController.HandleOutputLogEntry(i,u)}}if(n.Text&&typeof n.Text!="undefined"&&n.Text.length>0&&a(n.Text,$(f)),n.DismissType=="manual"){const i=document.createElement("div"),t=document.createElement("a");$(f).append(i);$(i).addClass("btn-wrapper").append(t);t.classList.add("dismiss-feedback");t.classList.add("button");t.innerText=n.DismissBtnText||"Ok";$(t).on("click",e)}else s=n.DismissTimeout||8e3,setTimeout(()=>e(),s);if(n.DoItForMe!=undefined){const t=document.createElement("a"),i=document.createElement("div");$(f).append(i);$(i).addClass("btn-wrapper").append(t);t.classList.add("doItForMe");t.classList.add("button");t.innerText="Gør det for mig";$(t).on("click",()=>(e(),n.DoItForMe(),$(t).remove(),!1))}}function h(){r("disableFeedback");$("feedback-component").addClass("hidden");t.showFeedback=!1}function c(){r("enableFeedback");$("feedback-component").removeClass("hidden");t.showFeedback=!0}function l(){$("feedback-component").remove()}function r(n,i){t.debugMode===!0&&console.log(n,i);typeof t.logController=="Object"}function a(){r("handleRestartExercise (feedbackController)");l()}_logController=t.logController;t.showFeedback=!0;const u=[];return this.FCHandleRestartExercise=a,this.EnableFeedback=c,this.DisableFeedback=h,this.AddFeedbackToArray=e,this.ShowTaskFeedback=o,this.ShowInteractionFeedback=s,this};ITEM.FeedbackController.FeedbackItem=function(n){function t(n,t){this.Mood=n;this.Size=t}function i(n,t){this.Type=n;this.ScopeId=t}function r(n,t){this.DisplayType=n;this.DisplayThreshold=t}function u(n){this.InteractionHighlights.push(n)}function f(n){this.InteractionHighlights.concat(n)}function e(n,t,i,r,u){this.DismissType=n;this.DismissTimeout=t;this.DismissBtnText=i;this.DoItForMe=r;this.DismissCallback=u}return this.ScopeId,this.Type,this.DisplayType,this.DisplayThreshold,this.Text=n,this.InteractionHighlights=[],this.DismissType,this.DismissTimeout,this.DismissBtnText,this.DismissCallback,this.Mood,this.Size,this.DoItForMe,this.SetStyleType=t,this.SetType=i,this.SetDisplay=r,this.SetInteractionHighlightAsArray=u,this.SetInteractionHighlight=f,this.SetDismiss=e,this};ITEM.InputController=function(n){function ut(n){InputControllerState.currentTaskObject=n;t("inputcontroller init",InputControllerState.currentTask);si();hi(InputControllerState.currentTask)}function ft(i){InputControllerState.currentTask=$(n.exerciseContainerSelector).find(o);InputControllerState.currentTaskObject=i;t("initTask (inputcontroller)",{taskObj:i,currentTask:InputControllerState.currentTask});a(i)}function a(){b();fi();k();t("initNewTaskInteraction (inputController)",InputControllerState);v();et(InputControllerState.currentTask);at();r("Task Start.","status")}function et(n){Array.from(n.find("input")).forEach(n=>{let t={id:n.getAttribute("id"),value:n.value};InputControllerState.taskInputfieldArray.push(t)});setTimeout(function(){n.find("input:first").trigger("focus")},100)}function v(){yt();vt();typeof InputControllerState.currentTaskObject!="undefined"&&InputControllerState.currentTaskObject&&InputControllerState.currentTaskObject[u].forEach(n=>{InputControllerState.interactionObjectArray.push(n)})}function ot(n){InputControllerState.currentClickEvent=n;InputControllerState.currentClickTarget=n.target;t("mouseClickHandler",n);ni(n);InputControllerState.isReportingRectangles?li(n):l(n)}function st(n){InputControllerState.currentRightClickEvent=n;InputControllerState.currentRightClickEvent=n.target;ti(n);l(n)}function ht(n){InputControllerState.currentDblClickEvent=n;InputControllerState.currentDblClickTarget=n.target;ii(n);l(n)}function ct(n){n.preventDefault();n.stopPropagation();t("keyUpHandler (START):",{exerciseHasFocus:$("#assetContentWrapper").is(":focus").toString(),event:n});lt(n);ri(n);pt(n)}function t(t,i){n.debugMode&&console.log(t,i)}function lt(n){if(InputControllerState.shiftKey=n.shiftKey,InputControllerState.ctrlKey=n.ctrlKey,InputControllerState.altKey=n.altKey,InputControllerState.currentKey=n.key,n.key.length<2){let t=InputControllerState.currentStringInstance+n.key;InputControllerState.currentStringInstance=t}else if(n.key.length>1){let n=InputControllerState.currentStringInstance+"*";InputControllerState.currentStringInstance=n}}function at(n){let e=null;typeof InputControllerState?.currentTaskObject!="undefined"&&InputControllerState?.currentTaskObject&&(e=InputControllerState.currentTaskObject[u]?.filter(n=>n[s]==nt));t("initMouseOver",{task:n,currentTask:InputControllerState.currentTaskObject,state:InputControllerState,mouseoverObjects:e});e?.forEach(n=>{t("initMouseOver iObj",n);let h=$(`#${InputControllerState.currentTaskObject[f]}`),e=n[f],o=n[i],u=h.find(`[data-interaction='${e}']`),s=1;u.on("mouseover",function(n){if(u.hasClass("mouseover")){let f={event:n,timeStamp:Date.now(),explainer:`Brugeren bevægede musen over et element: ${u.prop("nodeName")}`,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,type:"mouseover"};t("Mouseover event",f);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,f);r("Task Complete.","status",s);typeof o!="undefined"&&o.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n&&n(e,"correct",{interactionAttempts:s,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject?.callback()}})})}function vt(){InputControllerState.interactionObjectArray=[]}function yt(){InputControllerState.currentStringInstance=""}function y(r){if(InputControllerState.interactionCount++,!n.discreteFeedback)for(let n=0;n<InputControllerState.currentTaskObject[u].length;n++){let e=InputControllerState.currentTaskObject[u][n],o=e[s],f=e.id;t("! discreteFeedback",{event:r,iObj:e,interactionCount:InputControllerState.interactionCount});switch(o){case"click":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount,iObj:e})});break;case"dblclick":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;case"rightclick":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;case"keydown":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount,iObj:e})});break;case"stringinput":InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})});break;default:InputControllerState.currentTaskObject[i].forEach(n=>{t("checkInteractionFeedback, feedback",n),typeof n!="undefined"&&n(f,"attempts",{interactionAttempts:InputControllerState.interactionCount})})}}}function l(n){if(t("checkMouseInteraction (start)",n),typeof InputControllerState.currentTaskObject!="undefined"&&InputControllerState.currentTaskObject&&InputControllerState.currentTask!=null&&InputControllerState.currentTask.hasClass("active")&&$(n.target).parents(".feedback-wrapper").length==0){for(let t=0;t<InputControllerState.currentTaskObject[u].length;t++){let i=InputControllerState.currentTaskObject[u][t],r=i[s];switch(r){case"click":n.which==1?kt(n,i):!1;break;case"dblclick":n.type=="dblclick"?gt(n,i):!1;break;case"rightclick":n.which==3?dt(n,i):!1}}y(n)}}function pt(n){t("checkKeyboardInteraction (event):",n);let r=InputControllerState?.currentTaskObject,i=InputControllerState.currentTask;if(typeof r!="undefined"&&i!=null&&i.hasClass("active")){for(let i=0;i<InputControllerState.currentTaskObject[u].length;i++){let r=InputControllerState.currentTaskObject[u][i],f=r[s];t("checkKeyboardInteraction (foreach iObj)",{iObj:r,interactionType:r.type,InputControllerStatecurrentTaskObject:InputControllerState.currentTaskObject});switch(f){case"keydown":n.type!="mousedown"&&$(n.target).is(":not(input)")&&(t("checkKeyboardInteraction (interactionType:)",f),wt(n,r));break;case"stringinput":n.type!="mousedown"&&$(n.target).is("input")&&bt(n,r)}}y(n)}}function p(n,t){for(let i of t){let t=0;for(let r of n)if(i.includes(r)&&(t++,t==i.length))return!0}return!1}function w(n){let t=[];return t.push(n.key),InputControllerState.flavorKeys.forEach(i=>{switch(i){case"Control":n.ctrlKey&&t.push(i);break;case"Alt":n.altKey&&t.push(i);break;case"Shift":n.shiftKey&&t.push(i)}}),t}function wt(u,f){if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptKeyCount++;let e=f[c],o=InputControllerState.currentTaskObject[i],s=f.id;if(typeof e!="undefined"&&e.length>0)for(let h=0;h<e.length;h++){let c=e[h],l=c.correctInput;if(t(`checkMatchKeyPress (assessment loop: #${h})`,{iObj:f,assessment:c}),typeof l!="undefined"&&l){let e=InputControllerState.taskAttemptKeyCount,h=[],c=[];h=w(u);l.forEach(n=>c.push(n.split("+")));let a=p(h,c);a?(t("checkMatchKeyPress [CORRECT]",InputControllerState.currentTaskObject),r("Task Complete.","status",e),typeof o!="undefined"&&o.length>0?(t("checkMatchKeyPress [CORRECT, HAS FEEDBACK]:",o),o.forEach(n=>{t("checkMatchKeyPress [CORRECT, LOOPING FEEDBACK]:",n),typeof n!="undefined"&&n(s,"correct",{interactionAttempts:e,callback:InputControllerState.currentTaskObject.callback})})):(t("checkMatchKeyPress [CORRECT, NO FEEDBACK]",f),InputControllerState.currentTaskObject?.callback())):n.discreteFeedback&&(t("checkMatchKeyPress [WRONG]",InputControllerState.currentTaskObject[g]),InputControllerState.currentTaskObject[i].forEach(n=>{t("checkMatchKeyPress [WRONG], feedback",n),typeof n!="undefined"&&n(s,"attempts",{interactionAttempts:e})}))}else t("CheckMatchKeyPress ERROR: (assessment correctKey not specified!)",c),InputControllerState.currentTaskObject.callback()}}else t("Error (Input Controller): No task object found.",u)}function bt(u,e){let h=$(u.target),a=h.attr("data-interaction"),o=e[f],l=e[c],s=e[i];if(t("checkMatchString() ",{iObj:e}),a==o&&typeof l!="undefined"&&l&&l.length>0)for(let f=0;f<l.length;f++){let y=e[c][f],l=y[tt],v=y[it],b=y[rt];if(l.length>0&&(typeof v=="undefined"||v.length==0)){t("checkMatchString (no attemptTrigger)");let n=InputControllerState.currentStringInstance.length,u=l.find(n=>n==h.val()),f=l.reduce(function(n,t){return n.length>t.length?n:t});u?(r("Task Complete.","status",n),typeof s!="undefined"&&s.length>0?InputControllerState.currentTaskObject[i].forEach(t=>{typeof t!="undefined"&&t(o,"correct",{interactionAttempts:n,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n>f.length&&InputControllerState.currentTaskObject[i].forEach(t=>{typeof t!="undefined"&&t(o,"attempts",{interactionAttempts:n})})}else if(l.length>0&&typeof v!="undefined")for(let f=0;f<v.length;f++){let c=v[f];if(typeof c=="string"){let f=[];f.push(c.split("+"));let v=w(u),y=p(v,f);if(y){InputControllerState.taskAttemptInputfieldInputCount++;let u=InputControllerState.taskAttemptInputfieldInputCount;if(a==o){let f=!1;f=b?l.find(n=>n==h.val()):l.find(n=>n.toLowerCase()==h.val().toLowerCase());f?(r("Task Complete.","status",u),t("checkMatchString (correctInput)",e),typeof s!="undefined"&&s.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"correct",{interactionAttempts:u,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):(t("checkMatchString (wrong Input)",e),n.discreteFeedback&&InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"attempts",{interactionAttempts:u})}))}}}else if(typeof c=="number"){let f=InputControllerState.taskKeyDownLogArray.filter(n=>n.event.target.nodeName=="INPUT");InputControllerState.taskAttemptInputfieldInputCount++;let t=InputControllerState.taskAttemptInputfieldInputCount,u=y.correctInput.find(n=>n==h.val());u?(r("Task Complete.","status",t),typeof s!="undefined"&&s.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"correct",{interactionAttempts:t,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"attempts",{interactionAttempts:t})})}}}}function kt(u,e){let o=u.target,s=o.getAttribute("data-interaction"),h=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptClickCount++;let f=InputControllerState.taskAttemptClickCount;t("checkMatchClick (start)",{event:u,attempts:f,target:o});u.type=="mousedown"&&typeof s!="undefined"&&s&&h==s&&$(o).hasClass("click")?(r("Task Complete.","status",f),typeof c!="undefined"&&c.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(h,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&(t("checkMatchClick (WRONG)",{event:u,attempts:f,interactionFeedback:InputControllerState.currentTaskObject[i]}),InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(h,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function dt(u,e){let s=u.target,h=s.getAttribute("data-interaction"),o=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptRightClickCount++;let f=InputControllerState.taskAttemptRightClickCount;u.which==3&&typeof h!="undefined"&&o==h&&$(s).hasClass("rightclick")?(r("Task Complete.","status",f),typeof c!="undefined"&&c.length>0?InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})}):InputControllerState.currentTaskObject.callback()):n.discreteFeedback&&(t("checkMatchRightClick (WRONG) feedback",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function gt(u,e){let h=u.target,s=h.getAttribute("data-interaction"),o=e[f],c=e[i];if(typeof InputControllerState.currentTaskObject!="undefined"){InputControllerState.taskAttemptDblclickCount++;InputControllerState.taskAttemptClickCount--;InputControllerState.taskAttemptClickCount--;let f=InputControllerState.taskAttemptDblclickCount;u.type=="dblclick"&&typeof s!="undefined"&&o==s&&$(h).hasClass("dblclick")?(r("Task Complete.","status",f),t("dblClick correct!",{interactionId:o,targetId:s}),typeof c!="undefined"&&c.length>0?(t("dblClick (running through interactionFeedbackList",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{t("dblClick feedback (correct)",n),typeof n!="undefined"&&n(o,"correct",{interactionAttempts:f,callback:InputControllerState.currentTaskObject.callback})})):InputControllerState.currentTaskObject?.callback()):n.discreteFeedback&&(t("checkMatchDblClick (WRONG) feedback",InputControllerState.currentTaskObject),InputControllerState.currentTaskObject[i].forEach(n=>{typeof n!="undefined"&&n(o,"attempts",{interactionAttempts:f})}))}else t("Error (Input Controller): No task object found.",{event:u,iObj:e})}function ni(n){let s=$(o),t=h(n,s),r=t.relX,u=t.relY,f=t.relXpercent,e=t.relYpercent,i={timeStamp:Date.now(),event:n,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren klikkede på en < ${n.target.nodeName} > med klassen '${n.target.getAttribute("class")}' og ID '${n.target.getAttribute("id")}'. Pixel-Koordinater: ( ${r} ; ${u} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:r,relativeY:u,relativeXpc:f,relEventYpc:e,type:"click"};InputControllerState.taskEventLogArray.push(i);InputControllerState.taskMouseDownLogArray.push(i);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,i)}function ti(n){let s=$(o),t=h(n,s),r=t.relX,u=t.relY,f=t.relXpercent,e=t.relYpercent,i={timeStamp:Date.now(),event:n,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren HØJRE-klikkede på en < ${n.target.nodeName} > med klassen '${n.target.getAttribute("class")}' og ID '${n.target.getAttribute("id")}'. Pixel-Koordinater: ( ${r} ; ${u} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:r,relativeY:u,relativeXpc:f,relEventYpc:e,type:"contextmenu"};InputControllerState.taskEventLogArray.push(i);InputControllerState.taskRightClickLogArray.push(i);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,i)}function ii(n){let s=$(o),t=h(n,s),r=t.relX,u=t.relY,f=t.relXpercent,e=t.relYpercent,i={timeStamp:Date.now(),event:n,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,explainer:`Brugeren DOBBELT-klikkede på en < ${n.target.nodeName} > med klassen '${n.target.getAttribute("class")}' og ID '${n.target.getAttribute("id")}'. Pixel-Koordinater: ( ${r} ; ${u} ). Procent-Koordinater: ( ${f}% ; ${e}% ) `,relativeX:r,relativeY:u,relativeXpc:f,relEventYpc:e,type:"dblclick"};InputControllerState.taskEventLogArray.push(i);InputControllerState.taskDblClickLogArray.push(i);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,i)}function ri(n){let i=[];InputControllerState.taskInputfieldArray.forEach(n=>{let t={};for(let i in n)t[i]=n[i];i.push(t)});let t={timeStamp:Date.now(),event:n,task:InputControllerState.currentTask,taskObject:InputControllerState.currentTaskObject,InputFields:i,currentString:InputControllerState.currentStringInstance,currentKey:n.key,explainer:`Brugeren trykkede på tasten [${n.key}] ${n.altKey?"+ [ALT]":""} ${n.shiftKey?"+[SHIFT]":""} ${n.ctrlKey?"+[CTRL]":""}`,type:"key"};InputControllerState.taskKeyDownLogArray.push(t);InputControllerState.taskEventLogArray.push(t);_logController.HandleInputLogEntry(InputControllerState.currentTaskObject,t)}function h(n,t){let i;if(i=t!==void 0&&t?t.get(0):n.target,i&&n){const t=i.getBoundingClientRect(),r=n.clientX-t.left,u=n.clientY-t.top,f=r/t.width*100,e=u/t.height*100;return{relX:r,relY:u,relXpercent:f,relYpercent:e}}return!1}function r(n,t,i=null){let r={event:n,timeStamp:Date.now(),explainer:`${n}`,taskObject:InputControllerState.currentTaskObject,task:InputControllerState.currentTask,type:t};i!=null&&(r.attemptCount=i);InputControllerState.taskEventLogArray.push(r);_logController.HandleSecretLogEntry(InputControllerState.currentTaskObject,r)}function ui(){return{allEvents:InputControllerState.taskEventLogArray,keyDown:InputControllerState.taskKeyDownLogArray,InputFields:InputControllerState.taskInputfieldArray,mouseDown:InputControllerState.taskMouseDownLogArray,dblClick:InputControllerState.taskDblClickLogArray}}function b(){InputControllerState.taskEventLogArray=[];InputControllerState.taskKeyDownLogArray=[];InputControllerState.taskInputfieldArray=[];InputControllerState.taskMouseDownLogArray=[];InputControllerState.taskDblClickLogArray=[]}function fi(){InputControllerState.currentClickEvent=null;InputControllerState.currentClickTarget=null;InputControllerState.currentDblClickEvent=null;InputControllerState.currentDblClickTarget=null;InputControllerState.currentKey=null;InputControllerState.currentKeySequence=[];InputControllerState.currentString=null;InputControllerState.currentStringInstance=null}function ei(){t("clearInputFields (inputController.js)");$(n.exerciseContainerSelector).find("input").val("")}function k(){InputControllerState.interactionCount=0;InputControllerState.taskAttemptInputfieldInputCount=0;InputControllerState.taskAttemptKeyCount=0;InputControllerState.taskAttemptDblclickCount=0;InputControllerState.taskAttemptClickCount=0;InputControllerState.taskAttemptRightClickCount=0}function oi(){t("handleRestartExercise (inputcontroller)",InputControllerState);ei();k()}function si(){$(n.exerciseContainerSelector).off();let t=$("#assetContentWrapper .task:first");t.parent().off()}function hi(){let i=$("#assetContentWrapper .task:first");if(t("initGlobalEventListeners",{task:i,taskObject:InputControllerState.currentTaskObject}),n.keyDownDetect)$(i).parent().on("keyup",ct);if(n.mouseDownDetect){$(i).parent().on("mousedown",ot);$(i).parent().on("contextmenu",st)}if(n.dblClickDetect)$(i).parent().on("dblclick",ht)}function ci(n,i){t("toggleReportRectangle",{isOn:n,target:i,InputControllerState:InputControllerState});InputControllerState.isReportingRectangles=n;InputControllerState.reportTarget=i}function li(n){t("reportRectangle(event) : ",n);let r=InputControllerState.rectangleObjectArray,i=InputControllerState.rectanglePointArray,u=h(n);if(n.target.nodeName=="IMG"&&i.length<2&&($(`${e} input`).html("... klik igen ..."),i.push(u)),i.length>=2){let t={p0:i[0],p1:i[1]},n=ai(t);r.push(n);yi(n);InputControllerState.rectanglePointArray=[]}return!1}function ai(n){let t=n.p0.relXpercent,r=n.p1.relXpercent,i=n.p0.relYpercent,u=n.p1.relYpercent;t>r&&(t=n.p1.relXpercent,r=n.p0.relXpercent);i>u&&(i=n.p1.relYpercent,u=n.p0.relYpercent);let f=r-t,e=u-i;return{x:t,y:i,w:f,h:e}}function vi(n){let t="";if(n){let i=n.x,r=n.y,u=n.w,f=n.h;t=`{x:${i}, y:${r}, width:${u}, height:${f}}`}return t}function yi(n){let t=n;Object.keys(t).forEach(t=>{typeof n[t]=="number"&&(n[t]=bi(n[t],4))});let i=vi(t);$(`${e} input`).html(i);$(`${e} input`).val(i);$(`${e} span`).html("");$(e).removeClass("blink-change");$(e).addClass("blink-change");wi(n)}function pi(n){return Object.keys(n).forEach(t=>{typeof n[t]=="number"&&(n[t]=n[t]+"%")}),{left:n.x,top:n.y,width:n.w,height:n.h}}function wi(n){let u=pi(n),t=$(o).find(d),i=document.createElement("div"),r="mock-interaction";t.find(`.${r}`).remove();$(i).css(u).addClass(r);t.append(i)}function bi(n,t){var i=Math.pow(10,t||0);return Math.round(n*i)/i}_logController=n.logController;const o=".task.active:first",d=".interactions",g="taskFeedbackList",f="id",u="interactionList",c="assessmentList",i="interactionFeedbackList",s="type",nt="mouseover",tt="correctInput",it="attemptTrigger",rt="caseSensitive",e="#debug-msg";return InputControllerState={currentTask:null,interactionObjectArray:[],currentClickEvent:null,currentClickTarget:null,currentDblClickEvent:null,currentDblClickTarget:null,currentKeySequence:[],currentKey:null,currentStringInstance:typeof n.initialString!="undefined"?n.initialString:"",storedStringArray:n.initialStoredStringArray?n.initialStoredStringArray:[],interactionCount:0,taskAttemptInputfieldInputCount:0,taskAttemptKeyCount:0,taskAttemptDblclickCount:0,taskAttemptClickCount:0,taskAttemptRightClickCount:0,taskEventLogArray:[],taskMouseDownLogArray:[],taskRightClickLogArray:[],taskDblClickLogArray:[],taskKeyDownLogArray:[],taskInputfieldArray:[],flavorKeys:["Control","Shift","Alt"],isReportingRectangles:!1,reportTarget:null,rectanglePointArray:[],rectangleObjectArray:[]},this.InitInputController=ut,this.InitNewTaskInteraction=a,this.InitInteractionArray=v,this.InitTask=ft,this.StdLogEntry=r,this.GetEventLog=ui,this.ClearTaskEventLog=b,this.ICHandleRestartExercise=oi,this.ToggleReportRectangle=ci,this};ITEM.LogController=function(n,t){function o(){r({logID:"INIT",logEvent:[{timeStamp:Date.now(),explainer:"LOG CONTROLLER INIT",type:"status",task:null,taskObject:null,event:null}],logComment:null})}function u(t){n.debugMode&&(typeof t.event=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.event == undefined). Please specify event.",t),typeof t.timeStamp=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.timeStamp == undefined). Please set timestamp.",t),typeof t.task=="undefined"&&console.warn("Warning (LogController): eventobject not of expected shape (eventObject.task == undefined). Please specify current task.",t))}function s(n,t,f){u(t);let e={logID:n?.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"input",logComment:f};r(e,i)}function h(n,t,f){u(t);let e={logID:n?.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"output",logComment:f};r(e,i)}function c(n,t,f){u(t);let e={logID:n?.id+Date.now(),logTimeStamp:Date.now(),logEvent:t,logType:"secret",logComment:f};r(e,i)}function r(n,r){let u=r||i;u.push(n);t.push(n)}function l(n){e("storeLogEntry() :",n);let i,t;typeof n!="undefined"&&n?(t=f(i),n.userObject.taskLog=t):e("storeLogEntry() - taskObject ERROR")}function f(n){return n?i.filter(t=>t.logID==n):[]}function a(){return i}function e(t,i){n.debugMode&&console.log(t,i)}this.settings=n||{};let i=[];return o(),this.HandleInputLogEntry=s,this.HandleOutputLogEntry=h,this.HandleSecretLogEntry=c,this.StoreLogEntry=r,this.StoreLogEntriesToTaskObject=l,this.GetLogsById=f,this.GetLogs=a,this};ITEM.ResultsController=function(n,t){function i(){}function r(n){let i=[],r=[...n],t=[0];r.forEach((n,i)=>{n.logEvent.event=="Exercise Complete."&&t.push(i)});for(let n=1;n<t.length;n++){let u=t[n-1],f=t[n],e=r.slice(u+1,f+1);i.push(e)}return i}function u(n){let t=[],i=n.EventLog,u=r(i);return u.forEach((i,r)=>{let h=i.filter(n=>n.logType=="secret"),c=i.filter(n=>n.logType=="output"),p=i.filter(n=>n.logType=="input"),l=h.filter(n=>n.logEvent.event=="Task Complete."),f=c.filter(n=>n.logEvent.event=="Task Auto-Completed."),a=f.length,v=n.exerciseName,e=i[0].logEvent.timeStamp,o=i[i.length-1].logEvent.timeStamp,s=o-e,y=s/1e3,w=l.length/0,u={index:r,name:v,exerciseStartTime:e,exerciseEndTime:o,exerciseTimeSpentMs:s,exerciseTimeSpendSeconds:y,exerciseMeanPrecision:null,exerciseAutocompleteCount:a,exerciseAutoCompleteEvents:f,allUserEvents:[],exerciseTaskResultObjectArray:[]};i.forEach(n=>{let t=!1,i=null,r=null;n.logEvent.event=="Task Auto-Completed."&&(t=!0);typeof n.logEvent.taskObject!="undefined"&&(i=n.logEvent.taskObject.index);typeof n.logEvent.taskObject!="undefined"&&(r=n.logEvent.taskObject.subtitles);u.allUserEvents.push(n);let f={eventType:n.eventType,logEntry:n,userDidAutoCompleteEvent:t,index:i,subtitles:r};u.exerciseTaskResultObjectArray.push(f)});t.push(u)}),t}function f(){let n=[];return t.TaskObjectArray.forEach(t=>{let i={},r=t.userObject.taskLog,e=r[0].logTimeStamp,o=r[r.length-1].logTimeStamp,u=o-e,s=u/1e3,f=t.userObject.taskLog.filter(n=>n.logEvent.event.originalEvent instanceof KeyboardEvent||n.logEvent.event.originalEvent instanceof MouseEvent),h=Math.round(100/f.length,3),c=t.userObject.taskLog.filter(n=>n.logEvent.event=="Task Auto-Completed.").length>0;i.index=t.index;i.userDidAutoCompleteEvent=c;i.timeSpentMs=u;i.timeSpentSeconds=s;i.userPrecision=h;i.screenshot=t.screenshot;i.userEvents=f;i.subtitles=t.subtitles;n.push(i)}),n}function e(){}function o(){}const s=n.exerciseSelector;return i(),this.GetExerciseResultObjectArray=u,this.PrepareTaskResultArray=f,this.PrepareExerciseIntroOverlay=o,this.GenerateExerciseResults=e,this};